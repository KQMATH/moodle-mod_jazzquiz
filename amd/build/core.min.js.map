{"version":3,"file":"core.min.js","sources":["../src/core.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module    mod_jazzquiz\n * @author    Sebastian S. Gundersen <sebastian@sgundersen.com>\n * @copyright 2014 University of Wisconsin - Madison\n * @copyright 2018 NTNU\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {getString} from 'core/str';\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport {Question} from 'mod_jazzquiz/question';\n\n// Contains the needed values for using the ajax script.\nlet session = {\n    courseModuleId: 0,\n    sessionId: 0,\n    attemptId: 0,\n    sessionKey: ''\n};\n\nexport class Quiz {\n\n    constructor(Role) {\n        this.state = '';\n        this.isNewState = false;\n        this.question = new Question(this);\n        this.role = new Role(this);\n        this.events = {\n            notrunning: 'onNotRunning',\n            preparing: 'onPreparing',\n            running: 'onRunning',\n            reviewing: 'onReviewing',\n            sessionclosed: 'onSessionClosed',\n            voting: 'onVoting'\n        };\n    }\n\n    changeQuizState(data) {\n        this.isNewState = (this.state !== data.state);\n        this.state = data.state;\n        if (this.role.onStateChange !== undefined) {\n            this.role.onStateChange();\n        }\n        const event = this.events[data.state];\n        this.role[event](data);\n    }\n\n    /**\n     * Start polling for the current session state.\n     * @param {number} ms interval in milliseconds\n     */\n    poll(ms) {\n        Ajax.call({\n            methodname: 'mod_jazzquiz_poll',\n            args: {cmid: session.courseModuleId, sessionid: session.sessionId}\n        })[0].done(data => {\n            this.changeQuizState(data);\n            setTimeout(() => this.poll(ms), ms);\n        }).fail(Notification.exception);\n    }\n\n}\n\n/**\n * Retrieve a language string that was sent along with the page.\n * @param {HTMLElement} element\n * @param {string} key Which string in the language file we want.\n * @param {string} [from=jazzquiz] Which language file we want the string from. Default is jazzquiz.\n * @param {array} [args=[]] This is {$a} in the string for the key.\n */\nexport async function setText(element, key, from, args) {\n    from = (from !== undefined) ? from : 'jazzquiz';\n    args = (args !== undefined) ? args : [];\n    element.innerHTML = await getString(key, from, args);\n    element.classList.remove('hidden');\n}\n\n/**\n * Initialize session data.\n *\n * @param {number} courseModuleId\n * @param {number} sessionId\n * @param {number} attemptId\n * @param {string} sessionKey\n */\nexport function initialize(courseModuleId, sessionId, attemptId, sessionKey) {\n    session.courseModuleId = courseModuleId;\n    session.sessionId = sessionId;\n    session.attemptId = attemptId;\n    session.sessionKey = sessionKey;\n}\n"],"names":["courseModuleId","sessionId","attemptId","sessionKey","session","element","key","from","args","undefined","innerHTML","classList","remove","constructor","Role","state","isNewState","question","Question","this","role","events","notrunning","preparing","running","reviewing","sessionclosed","voting","changeQuizState","data","onStateChange","event","poll","ms","call","methodname","cmid","sessionid","done","setTimeout","fail","Notification","exception"],"mappings":";;;;;;;+GAqG2BA,eAAgBC,UAAWC,UAAWC,YAC7DC,QAAQJ,eAAiBA,eACzBI,QAAQH,UAAYA,UACpBG,QAAQF,UAAYA,UACpBE,QAAQD,WAAaA,4CAnBKE,QAASC,IAAKC,KAAMC,MAC9CD,UAAiBE,IAATF,KAAsBA,KAAO,WACrCC,UAAiBC,IAATD,KAAsBA,KAAO,GACrCH,QAAQK,gBAAkB,kBAAUJ,IAAKC,KAAMC,MAC/CH,QAAQM,UAAUC,OAAO,uGA7DzBR,QAAU,CACVJ,eAAgB,EAChBC,UAAW,EACXC,UAAW,EACXC,WAAY,wBAKZU,YAAYC,WACHC,MAAQ,QACRC,YAAa,OACbC,SAAW,IAAIC,mBAASC,WACxBC,KAAO,IAAIN,KAAKK,WAChBE,OAAS,CACVC,WAAY,eACZC,UAAW,cACXC,QAAS,YACTC,UAAW,cACXC,cAAe,kBACfC,OAAQ,YAIhBC,gBAAgBC,WACPb,WAAcG,KAAKJ,QAAUc,KAAKd,WAClCA,MAAQc,KAAKd,WACcN,IAA5BU,KAAKC,KAAKU,oBACLV,KAAKU,sBAERC,MAAQZ,KAAKE,OAAOQ,KAAKd,YAC1BK,KAAKW,OAAOF,MAOrBG,KAAKC,kBACIC,KAAK,CACNC,WAAY,oBACZ3B,KAAM,CAAC4B,KAAMhC,QAAQJ,eAAgBqC,UAAWjC,QAAQH,aACzD,GAAGqC,MAAKT,YACFD,gBAAgBC,MACrBU,YAAW,IAAMpB,KAAKa,KAAKC,KAAKA,OACjCO,KAAKC,sBAAaC"}