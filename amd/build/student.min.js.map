{"version":3,"file":"student.min.js","sources":["../src/student.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module    mod_jazzquiz\n * @author    Sebastian S. Gundersen <sebastian@sgundersen.com>\n * @copyright 2014 University of Wisconsin - Madison\n * @copyright 2018 NTNU\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {Quiz, Ajax, setText} from 'mod_jazzquiz/core';\nimport selectors from 'mod_jazzquiz/selectors';\n\nclass Student {\n\n    /**\n     * @param {Quiz} quiz\n     */\n    constructor(quiz) {\n        this.quiz = quiz;\n        this.voteAnswer = undefined;\n\n        document.addEventListener('submit', event => {\n            const questionForm = event.target.closest(selectors.question.form);\n            if (questionForm) {\n                event.preventDefault();\n                this.submitAnswer();\n            }\n        });\n\n        document.addEventListener('click', event => {\n            const saveVoteButton = event.target.closest(selectors.quiz.saveVoteButton);\n            if (saveVoteButton) {\n                this.saveVote();\n            }\n            const selectVoteButton = event.target.closest(selectors.quiz.selectVoteButton);\n            if (selectVoteButton) {\n                this.voteAnswer = selectVoteButton.value;\n            }\n        });\n    }\n\n    onNotRunning() {\n        setText(document.querySelector(selectors.quiz.info), 'instructions_for_student');\n    }\n\n    onPreparing() {\n        setText(document.querySelector(selectors.quiz.info), 'wait_for_instructor');\n    }\n\n    onRunning(data) {\n        if (this.quiz.question.isRunning) {\n            return;\n        }\n        const started = this.quiz.question.startCountdown(data.questiontime, data.delay);\n        if (!started) {\n            setText(document.querySelector(selectors.quiz.info), 'wait_for_instructor');\n        }\n    }\n\n    onReviewing() {\n        this.quiz.question.isVoteRunning = false;\n        this.quiz.question.isRunning = false;\n        this.quiz.question.hideTimer();\n        document.querySelector(selectors.question.box).classList.add('hidden');\n        setText(document.querySelector(selectors.quiz.info), 'wait_for_instructor');\n    }\n\n    onSessionClosed() {\n        window.location = location.href.split('&')[0];\n    }\n\n    onVoting(data) {\n        if (this.quiz.question.isVoteRunning) {\n            return;\n        }\n        const quizInfo = document.querySelector(selectors.quiz.info);\n        quizInfo.innerHTML = data.html;\n        quizInfo.classList.remove('hidden');\n        const options = data.options;\n        for (let i = 0; i < options.length; i++) {\n            Quiz.addMathjaxElement(document.getElementById(options[i].content_id), options[i].text);\n            if (options[i].question_type === 'stack') {\n                Quiz.renderMaximaEquation(options[i].text, options[i].content_id);\n            }\n        }\n        this.quiz.question.isVoteRunning = true;\n    }\n\n    onTimerTick(timeLeft) {\n        setText(document.querySelector(selectors.question.timer), 'question_will_end_in_x_seconds', 'jazzquiz', timeLeft);\n    }\n\n    /**\n     * Submit answer for the current question.\n     */\n    submitAnswer() {\n        if (this.quiz.question.isSaving) {\n            // Don't save twice.\n            return;\n        }\n        this.quiz.question.isSaving = true;\n        if (typeof tinyMCE !== 'undefined') {\n            // eslint-disable-next-line no-undef\n            tinyMCE.triggerSave();\n        }\n        const serialized = document.querySelector(selectors.question.form).serializeArray();\n        let data = {};\n        for (let name in serialized) {\n            if (serialized.hasOwnProperty(name)) {\n                data[serialized[name].name] = serialized[name].value;\n            }\n        }\n        Ajax.post('save_question', data, data => {\n            const quizInfo = document.querySelector(selectors.quiz.info);\n            if (data.feedback.length > 0) {\n                quizInfo.innerHTML = data.feedback;\n                quizInfo.classList.remove('hidden');\n            } else {\n                setText(quizInfo, 'wait_for_instructor');\n            }\n            this.quiz.question.isSaving = false;\n            if (!this.quiz.question.isRunning) {\n                return;\n            }\n            if (this.quiz.question.isVoteRunning) {\n                return;\n            }\n            document.querySelector(selectors.question.box).classList.add('hidden');\n            this.quiz.question.hideTimer();\n        }).fail(() => {\n            this.quiz.question.isSaving = false;\n        });\n    }\n\n    saveVote() {\n        Ajax.post('save_vote', {vote: this.voteAnswer}, data => {\n            const quizInfo = document.querySelector(selectors.quiz.info);\n            if (data.status === 'success') {\n                setText(quizInfo, 'wait_for_instructor');\n            } else {\n                setText(quizInfo, 'you_already_voted');\n            }\n        });\n    }\n\n}\n\n/**\n * Initialize student session.\n */\nexport function initialize() {\n    let quiz = new Quiz(Student);\n    quiz.poll(2000);\n}\n"],"names":["Quiz","Student","poll","constructor","quiz","voteAnswer","undefined","document","addEventListener","event","target","closest","selectors","question","form","preventDefault","submitAnswer","saveVoteButton","saveVote","selectVoteButton","value","onNotRunning","querySelector","info","onPreparing","onRunning","data","this","isRunning","startCountdown","questiontime","delay","onReviewing","isVoteRunning","hideTimer","box","classList","add","onSessionClosed","window","location","href","split","onVoting","quizInfo","innerHTML","html","remove","options","i","length","addMathjaxElement","getElementById","content_id","text","question_type","renderMaximaEquation","onTimerTick","timeLeft","timer","isSaving","tinyMCE","triggerSave","serialized","serializeArray","name","hasOwnProperty","post","feedback","fail","vote","status"],"mappings":";;;;;;;4FAqKe,IAAIA,WAAKC,SACfC,KAAK,0EA5IRD,QAKFE,YAAYC,WACHA,KAAOA,UACPC,gBAAaC,EAElBC,SAASC,iBAAiB,UAAUC,QACXA,MAAMC,OAAOC,QAAQC,mBAAUC,SAASC,QAEzDL,MAAMM,sBACDC,mBAIbT,SAASC,iBAAiB,SAASC,QACRA,MAAMC,OAAOC,QAAQC,mBAAUR,KAAKa,sBAElDC,iBAEHC,iBAAmBV,MAAMC,OAAOC,QAAQC,mBAAUR,KAAKe,kBACzDA,wBACKd,WAAac,iBAAiBC,UAK/CC,iCACYd,SAASe,cAAcV,mBAAUR,KAAKmB,MAAO,4BAGzDC,gCACYjB,SAASe,cAAcV,mBAAUR,KAAKmB,MAAO,uBAGzDE,UAAUC,SACFC,KAAKvB,KAAKS,SAASe,iBAGPD,KAAKvB,KAAKS,SAASgB,eAAeH,KAAKI,aAAcJ,KAAKK,0BAE9DxB,SAASe,cAAcV,mBAAUR,KAAKmB,MAAO,uBAI7DS,mBACS5B,KAAKS,SAASoB,eAAgB,OAC9B7B,KAAKS,SAASe,WAAY,OAC1BxB,KAAKS,SAASqB,YACnB3B,SAASe,cAAcV,mBAAUC,SAASsB,KAAKC,UAAUC,IAAI,4BACrD9B,SAASe,cAAcV,mBAAUR,KAAKmB,MAAO,uBAGzDe,kBACIC,OAAOC,SAAWA,SAASC,KAAKC,MAAM,KAAK,GAG/CC,SAASjB,SACDC,KAAKvB,KAAKS,SAASoB,2BAGjBW,SAAWrC,SAASe,cAAcV,mBAAUR,KAAKmB,MACvDqB,SAASC,UAAYnB,KAAKoB,KAC1BF,SAASR,UAAUW,OAAO,gBACpBC,QAAUtB,KAAKsB,YAChB,IAAIC,EAAI,EAAGA,EAAID,QAAQE,OAAQD,eAC3BE,kBAAkB5C,SAAS6C,eAAeJ,QAAQC,GAAGI,YAAaL,QAAQC,GAAGK,MACjD,UAA7BN,QAAQC,GAAGM,0BACNC,qBAAqBR,QAAQC,GAAGK,KAAMN,QAAQC,GAAGI,iBAGzDjD,KAAKS,SAASoB,eAAgB,EAGvCwB,YAAYC,4BACAnD,SAASe,cAAcV,mBAAUC,SAAS8C,OAAQ,iCAAkC,WAAYD,UAM5G1C,kBACQW,KAAKvB,KAAKS,SAAS+C,qBAIlBxD,KAAKS,SAAS+C,UAAW,EACP,oBAAZC,SAEPA,QAAQC,oBAENC,WAAaxD,SAASe,cAAcV,mBAAUC,SAASC,MAAMkD,qBAC/DtC,KAAO,OACN,IAAIuC,QAAQF,WACTA,WAAWG,eAAeD,QAC1BvC,KAAKqC,WAAWE,MAAMA,MAAQF,WAAWE,MAAM7C,kBAGlD+C,KAAK,gBAAiBzC,MAAMA,aACvBkB,SAAWrC,SAASe,cAAcV,mBAAUR,KAAKmB,MACnDG,KAAK0C,SAASlB,OAAS,GACvBN,SAASC,UAAYnB,KAAK0C,SAC1BxB,SAASR,UAAUW,OAAO,6BAElBH,SAAU,4BAEjBxC,KAAKS,SAAS+C,UAAW,EACzBjC,KAAKvB,KAAKS,SAASe,YAGpBD,KAAKvB,KAAKS,SAASoB,gBAGvB1B,SAASe,cAAcV,mBAAUC,SAASsB,KAAKC,UAAUC,IAAI,eACxDjC,KAAKS,SAASqB,iBACpBmC,MAAK,UACCjE,KAAKS,SAAS+C,UAAW,KAItC1C,sBACSiD,KAAK,YAAa,CAACG,KAAM3C,KAAKtB,aAAaqB,aACtCkB,SAAWrC,SAASe,cAAcV,mBAAUR,KAAKmB,MACnC,YAAhBG,KAAK6C,yBACG3B,SAAU,yCAEVA,SAAU"}