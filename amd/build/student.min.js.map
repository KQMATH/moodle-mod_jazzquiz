{"version":3,"file":"student.min.js","sources":["../src/student.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module    mod_jazzquiz\n * @author    Sebastian S. Gundersen <sebastian@sgundersen.com>\n * @copyright 2014 University of Wisconsin - Madison\n * @copyright 2018 NTNU\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport {Quiz, Ajax, setText} from 'mod_jazzquiz/core';\nimport {Question} from 'mod_jazzquiz/question';\n\nclass Student {\n\n    /**\n     * @param {Quiz} quiz\n     */\n    constructor(quiz) {\n        this.quiz = quiz;\n        this.voteAnswer = undefined;\n        let self = this;\n        $(document).on('submit', '#jazzquiz_question_form', function(event) {\n            event.preventDefault();\n            self.submitAnswer();\n        }).on('click', '#jazzquiz_save_vote', function() {\n            self.saveVote();\n        }).on('click', '.jazzquiz-select-vote', function() {\n            self.voteAnswer = this.value;\n        });\n    }\n\n    onNotRunning() {\n        setText(Quiz.info, 'instructions_for_student');\n    }\n\n    onPreparing() {\n        setText(Quiz.info, 'wait_for_instructor');\n    }\n\n    onRunning(data) {\n        if (this.quiz.question.isRunning) {\n            return;\n        }\n        const started = this.quiz.question.startCountdown(data.questiontime, data.delay);\n        if (!started) {\n            setText(Quiz.info, 'wait_for_instructor');\n        }\n    }\n\n    onReviewing() {\n        this.quiz.question.isVoteRunning = false;\n        this.quiz.question.isRunning = false;\n        this.quiz.question.hideTimer();\n        Quiz.hide(Question.box);\n        setText(Quiz.info, 'wait_for_instructor');\n    }\n\n    onSessionClosed() {\n        window.location = location.href.split('&')[0];\n    }\n\n    onVoting(data) {\n        if (this.quiz.question.isVoteRunning) {\n            return;\n        }\n        Quiz.info.html(data.html);\n        Quiz.show(Quiz.info);\n        const options = data.options;\n        for (let i = 0; i < options.length; i++) {\n            Quiz.addMathjaxElement($('#' + options[i].content_id), options[i].text);\n            if (options[i].question_type === 'stack') {\n                Quiz.renderMaximaEquation(options[i].text, options[i].content_id);\n            }\n        }\n        this.quiz.question.isVoteRunning = true;\n    }\n\n    onTimerTick(timeLeft) {\n        setText(Question.timer, 'question_will_end_in_x_seconds', 'jazzquiz', timeLeft);\n    }\n\n    /**\n     * Submit answer for the current question.\n     */\n    submitAnswer() {\n        if (this.quiz.question.isSaving) {\n            // Don't save twice.\n            return;\n        }\n        this.quiz.question.isSaving = true;\n        if (typeof tinyMCE !== 'undefined') {\n            // eslint-disable-next-line no-undef\n            tinyMCE.triggerSave();\n        }\n        const serialized = Question.form.serializeArray();\n        let data = {};\n        for (let name in serialized) {\n            if (serialized.hasOwnProperty(name)) {\n                data[serialized[name].name] = serialized[name].value;\n            }\n        }\n        Ajax.post('save_question', data, data => {\n            if (data.feedback.length > 0) {\n                Quiz.show(Quiz.info.html(data.feedback));\n            } else {\n                setText(Quiz.info, 'wait_for_instructor');\n            }\n            this.quiz.question.isSaving = false;\n            if (!this.quiz.question.isRunning) {\n                return;\n            }\n            if (this.quiz.question.isVoteRunning) {\n                return;\n            }\n            Quiz.hide(Question.box);\n            this.quiz.question.hideTimer();\n        }).fail(() => {\n            this.quiz.question.isSaving = false;\n        });\n    }\n\n    saveVote() {\n        Ajax.post('save_vote', {vote: this.voteAnswer}, data => {\n            if (data.status === 'success') {\n                setText(Quiz.info, 'wait_for_instructor');\n            } else {\n                setText(Quiz.info, 'you_already_voted');\n            }\n        });\n    }\n\n}\n\n/**\n * Initialize student session.\n */\nexport function initialize() {\n    let quiz = new Quiz(Student);\n    quiz.poll(2000);\n}\n"],"names":["Quiz","Student","poll","constructor","quiz","voteAnswer","undefined","self","this","document","on","event","preventDefault","submitAnswer","saveVote","value","onNotRunning","info","onPreparing","onRunning","data","question","isRunning","startCountdown","questiontime","delay","onReviewing","isVoteRunning","hideTimer","hide","Question","box","onSessionClosed","window","location","href","split","onVoting","html","show","options","i","length","addMathjaxElement","content_id","text","question_type","renderMaximaEquation","onTimerTick","timeLeft","timer","isSaving","tinyMCE","triggerSave","serialized","form","serializeArray","name","hasOwnProperty","post","feedback","fail","vote","status"],"mappings":";;;;;;;4FAwJe,IAAIA,WAAKC,SACfC,KAAK,oEA9HRD,QAKFE,YAAYC,WACHA,KAAOA,UACPC,gBAAaC,MACdC,KAAOC,yBACTC,UAAUC,GAAG,SAAU,2BAA2B,SAASC,OACzDA,MAAMC,iBACNL,KAAKM,kBACNH,GAAG,QAAS,uBAAuB,WAClCH,KAAKO,cACNJ,GAAG,QAAS,yBAAyB,WACpCH,KAAKF,WAAaG,KAAKO,SAI/BC,iCACYhB,WAAKiB,KAAM,4BAGvBC,gCACYlB,WAAKiB,KAAM,uBAGvBE,UAAUC,SACFZ,KAAKJ,KAAKiB,SAASC,iBAGPd,KAAKJ,KAAKiB,SAASE,eAAeH,KAAKI,aAAcJ,KAAKK,0BAE9DzB,WAAKiB,KAAM,uBAI3BS,mBACStB,KAAKiB,SAASM,eAAgB,OAC9BvB,KAAKiB,SAASC,WAAY,OAC1BlB,KAAKiB,SAASO,uBACdC,KAAKC,mBAASC,uBACX/B,WAAKiB,KAAM,uBAGvBe,kBACIC,OAAOC,SAAWA,SAASC,KAAKC,MAAM,KAAK,GAG/CC,SAASjB,SACDZ,KAAKJ,KAAKiB,SAASM,gCAGlBV,KAAKqB,KAAKlB,KAAKkB,iBACfC,KAAKvC,WAAKiB,YACTuB,QAAUpB,KAAKoB,YAChB,IAAIC,EAAI,EAAGA,EAAID,QAAQE,OAAQD,eAC3BE,mBAAkB,mBAAE,IAAMH,QAAQC,GAAGG,YAAaJ,QAAQC,GAAGI,MACjC,UAA7BL,QAAQC,GAAGK,0BACNC,qBAAqBP,QAAQC,GAAGI,KAAML,QAAQC,GAAGG,iBAGzDxC,KAAKiB,SAASM,eAAgB,EAGvCqB,YAAYC,4BACAnB,mBAASoB,MAAO,iCAAkC,WAAYD,UAM1EpC,kBACQL,KAAKJ,KAAKiB,SAAS8B,qBAIlB/C,KAAKiB,SAAS8B,UAAW,EACP,oBAAZC,SAEPA,QAAQC,oBAENC,WAAaxB,mBAASyB,KAAKC,qBAC7BpC,KAAO,OACN,IAAIqC,QAAQH,WACTA,WAAWI,eAAeD,QAC1BrC,KAAKkC,WAAWG,MAAMA,MAAQH,WAAWG,MAAM1C,kBAGlD4C,KAAK,gBAAiBvC,MAAMA,OACzBA,KAAKwC,SAASlB,OAAS,aAClBH,KAAKvC,WAAKiB,KAAKqB,KAAKlB,KAAKwC,6BAEtB5D,WAAKiB,KAAM,4BAElBb,KAAKiB,SAAS8B,UAAW,EACzB3C,KAAKJ,KAAKiB,SAASC,YAGpBd,KAAKJ,KAAKiB,SAASM,2BAGlBE,KAAKC,mBAASC,UACd3B,KAAKiB,SAASO,iBACpBiC,MAAK,UACCzD,KAAKiB,SAAS8B,UAAW,KAItCrC,sBACS6C,KAAK,YAAa,CAACG,KAAMtD,KAAKH,aAAae,OACxB,YAAhBA,KAAK2C,yBACG/D,WAAKiB,KAAM,yCAEXjB,WAAKiB,KAAM"}