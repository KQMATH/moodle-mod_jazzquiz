{"version":3,"file":"student.min.js","sources":["../src/student.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module    mod_jazzquiz\n * @author    Sebastian S. Gundersen <sebastian@sgundersen.com>\n * @copyright 2014 University of Wisconsin - Madison\n * @copyright 2018 NTNU\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Jazz from 'mod_jazzquiz/core';\n\nconst Quiz = Jazz.Quiz;\nconst Question = Jazz.Question;\nconst Ajax = Jazz.Ajax;\nconst setText = Jazz.setText;\n\nclass Student {\n\n    /**\n     * @param {Quiz} quiz\n     */\n    constructor(quiz) {\n        this.quiz = quiz;\n        this.voteAnswer = undefined;\n        let self = this;\n        $(document).on('submit', '#jazzquiz_question_form', function(event) {\n            event.preventDefault();\n            self.submitAnswer();\n        }).on('click', '#jazzquiz_save_vote', function() {\n            self.saveVote();\n        }).on('click', '.jazzquiz-select-vote', function() {\n            self.voteAnswer = this.value;\n        });\n    }\n\n    onNotRunning() {\n        setText(Quiz.info, 'instructions_for_student');\n    }\n\n    onPreparing() {\n        setText(Quiz.info, 'wait_for_instructor');\n    }\n\n    onRunning(data) {\n        if (this.quiz.question.isRunning) {\n            return;\n        }\n        const started = this.quiz.question.startCountdown(data.questiontime, data.delay);\n        if (!started) {\n            setText(Quiz.info, 'wait_for_instructor');\n        }\n    }\n\n    onReviewing() {\n        this.quiz.question.isVoteRunning = false;\n        this.quiz.question.isRunning = false;\n        this.quiz.question.hideTimer();\n        Quiz.hide(Question.box);\n        setText(Quiz.info, 'wait_for_instructor');\n    }\n\n    onSessionClosed() {\n        window.location = location.href.split('&')[0];\n    }\n\n    onVoting(data) {\n        if (this.quiz.question.isVoteRunning) {\n            return;\n        }\n        Quiz.info.html(data.html);\n        Quiz.show(Quiz.info);\n        const options = data.options;\n        for (let i = 0; i < options.length; i++) {\n            Quiz.addMathjaxElement($('#' + options[i].content_id), options[i].text);\n            if (options[i].question_type === 'stack') {\n                Quiz.renderMaximaEquation(options[i].text, options[i].content_id);\n            }\n        }\n        this.quiz.question.isVoteRunning = true;\n    }\n\n    onTimerTick(timeLeft) {\n        setText(Question.timer, 'question_will_end_in_x_seconds', 'jazzquiz', timeLeft);\n    }\n\n    /**\n     * Submit answer for the current question.\n     */\n    submitAnswer() {\n        if (this.quiz.question.isSaving) {\n            // Don't save twice.\n            return;\n        }\n        this.quiz.question.isSaving = true;\n        if (typeof tinyMCE !== 'undefined') {\n            // eslint-disable-next-line no-undef\n            tinyMCE.triggerSave();\n        }\n        const serialized = Question.form.serializeArray();\n        let data = {};\n        for (let name in serialized) {\n            if (serialized.hasOwnProperty(name)) {\n                data[serialized[name].name] = serialized[name].value;\n            }\n        }\n        Ajax.post('save_question', data, data => {\n            if (data.feedback.length > 0) {\n                Quiz.show(Quiz.info.html(data.feedback));\n            } else {\n                setText(Quiz.info, 'wait_for_instructor');\n            }\n            this.quiz.question.isSaving = false;\n            if (!this.quiz.question.isRunning) {\n                return;\n            }\n            if (this.quiz.question.isVoteRunning) {\n                return;\n            }\n            Quiz.hide(Question.box);\n            this.quiz.question.hideTimer();\n        }).fail(() => {\n            this.quiz.question.isSaving = false;\n        });\n    }\n\n    saveVote() {\n        Ajax.post('save_vote', {vote: this.voteAnswer}, data => {\n            if (data.status === 'success') {\n                setText(Quiz.info, 'wait_for_instructor');\n            } else {\n                setText(Quiz.info, 'you_already_voted');\n            }\n        });\n    }\n\n}\n\n/**\n * Initialize student session.\n */\nexport function initialize() {\n    let quiz = new Quiz(Student);\n    quiz.poll(2000);\n}\n"],"names":["Quiz","Student","poll","Question","Jazz","Ajax","setText","constructor","quiz","voteAnswer","undefined","self","this","document","on","event","preventDefault","submitAnswer","saveVote","value","onNotRunning","info","onPreparing","onRunning","data","question","isRunning","startCountdown","questiontime","delay","onReviewing","isVoteRunning","hideTimer","hide","box","onSessionClosed","window","location","href","split","onVoting","html","show","options","i","length","addMathjaxElement","content_id","text","question_type","renderMaximaEquation","onTimerTick","timeLeft","timer","isSaving","tinyMCE","triggerSave","serialized","form","serializeArray","name","hasOwnProperty","post","feedback","fail","vote","status"],"mappings":";;;;;;;4FA4Je,IAAIA,KAAKC,SACfC,KAAK,oDAnIRF,mDAAYA,KACZG,SAAWC,cAAKD,SAChBE,KAAOD,cAAKC,KACZC,QAAUF,cAAKE,cAEfL,QAKFM,YAAYC,WACHA,KAAOA,UACPC,gBAAaC,MACdC,KAAOC,yBACTC,UAAUC,GAAG,SAAU,2BAA2B,SAASC,OACzDA,MAAMC,iBACNL,KAAKM,kBACNH,GAAG,QAAS,uBAAuB,WAClCH,KAAKO,cACNJ,GAAG,QAAS,yBAAyB,WACpCH,KAAKF,WAAaG,KAAKO,SAI/BC,eACId,QAAQN,KAAKqB,KAAM,4BAGvBC,cACIhB,QAAQN,KAAKqB,KAAM,uBAGvBE,UAAUC,SACFZ,KAAKJ,KAAKiB,SAASC,iBAGPd,KAAKJ,KAAKiB,SAASE,eAAeH,KAAKI,aAAcJ,KAAKK,QAEtEvB,QAAQN,KAAKqB,KAAM,uBAI3BS,mBACStB,KAAKiB,SAASM,eAAgB,OAC9BvB,KAAKiB,SAASC,WAAY,OAC1BlB,KAAKiB,SAASO,YACnBhC,KAAKiC,KAAK9B,SAAS+B,KACnB5B,QAAQN,KAAKqB,KAAM,uBAGvBc,kBACIC,OAAOC,SAAWA,SAASC,KAAKC,MAAM,KAAK,GAG/CC,SAAShB,SACDZ,KAAKJ,KAAKiB,SAASM,qBAGvB/B,KAAKqB,KAAKoB,KAAKjB,KAAKiB,MACpBzC,KAAK0C,KAAK1C,KAAKqB,YACTsB,QAAUnB,KAAKmB,YAChB,IAAIC,EAAI,EAAGA,EAAID,QAAQE,OAAQD,IAChC5C,KAAK8C,mBAAkB,mBAAE,IAAMH,QAAQC,GAAGG,YAAaJ,QAAQC,GAAGI,MACjC,UAA7BL,QAAQC,GAAGK,eACXjD,KAAKkD,qBAAqBP,QAAQC,GAAGI,KAAML,QAAQC,GAAGG,iBAGzDvC,KAAKiB,SAASM,eAAgB,EAGvCoB,YAAYC,UACR9C,QAAQH,SAASkD,MAAO,iCAAkC,WAAYD,UAM1EnC,kBACQL,KAAKJ,KAAKiB,SAAS6B,qBAIlB9C,KAAKiB,SAAS6B,UAAW,EACP,oBAAZC,SAEPA,QAAQC,oBAENC,WAAatD,SAASuD,KAAKC,qBAC7BnC,KAAO,OACN,IAAIoC,QAAQH,WACTA,WAAWI,eAAeD,QAC1BpC,KAAKiC,WAAWG,MAAMA,MAAQH,WAAWG,MAAMzC,OAGvDd,KAAKyD,KAAK,gBAAiBtC,MAAMA,OACzBA,KAAKuC,SAASlB,OAAS,EACvB7C,KAAK0C,KAAK1C,KAAKqB,KAAKoB,KAAKjB,KAAKuC,WAE9BzD,QAAQN,KAAKqB,KAAM,4BAElBb,KAAKiB,SAAS6B,UAAW,EACzB1C,KAAKJ,KAAKiB,SAASC,YAGpBd,KAAKJ,KAAKiB,SAASM,gBAGvB/B,KAAKiC,KAAK9B,SAAS+B,UACd1B,KAAKiB,SAASO,iBACpBgC,MAAK,UACCxD,KAAKiB,SAAS6B,UAAW,KAItCpC,WACIb,KAAKyD,KAAK,YAAa,CAACG,KAAMrD,KAAKH,aAAae,OACxB,YAAhBA,KAAK0C,OACL5D,QAAQN,KAAKqB,KAAM,uBAEnBf,QAAQN,KAAKqB,KAAM"}