{"version":3,"file":"edit.min.js","sources":["../src/edit.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     mod_jazzquiz\n * @author     Sebastian S. Gundersen <sebastian@sgundersen.com>\n * @copyright  2015 University of Wisconsin - Madison\n * @copyright  2018 NTNU\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport selectors from 'mod_jazzquiz/selectors';\n\n/**\n * Submit the question order to the server. An empty array will delete all questions.\n * @param {Array.<number>} order\n * @param {number} courseModuleId\n */\nfunction submitQuestionOrder(order, courseModuleId) {\n    $.post('edit.php', {\n        id: courseModuleId,\n        action: 'order',\n        order: JSON.stringify(order)\n    }, () => location.reload()); // TODO: Correct locally instead, but for now just refresh.\n}\n\n/**\n * @returns {Array} The current question order.\n */\nfunction getQuestionOrder() {\n    const questions = document.querySelectorAll('.questionlist li');\n    return questions.map(question => question.dataset.questionId);\n}\n\n/**\n * Move a question up or down by a specified offset.\n * @param {number} questionId\n * @param {number} offset Negative to move down, positive to move up\n * @returns {Array}\n */\nfunction offsetQuestion(questionId, offset) {\n    let order = getQuestionOrder();\n    let originalIndex = order.indexOf(questionId);\n    if (originalIndex === -1) {\n        return order;\n    }\n    for (let i = 0; i < order.length; i++) {\n        if (i + offset === originalIndex) {\n            order[originalIndex] = order[i];\n            order[i] = questionId;\n            break;\n        }\n    }\n    return order;\n}\n\n/**\n * Add click-listener to a quiz by module id.\n * @param {number} courseModuleId\n */\nfunction listenAddToQuiz(courseModuleId) {\n    const addSelectedQuestionsButton = document.querySelector(selectors.edit.addSelectedQuestions);\n    addSelectedQuestionsButton.addEventListener('click', function() {\n        let questionIds = '';\n        for (const checkbox of document.querySelectorAll(selectors.edit.questionCheckedCheckbox)) {\n            questionIds += checkbox.getAttribute('name').slice(1) + ',';\n        }\n        $.post('edit.php', {\n            id: courseModuleId,\n            action: 'addquestion',\n            questionids: questionIds,\n        }, () => location.reload());\n    });\n}\n\n/**\n * Initialize edit page.\n * @param {number} courseModuleId\n */\nexport function initialize(courseModuleId) {\n    document.addEventListener('click', event => {\n        const editQuestionAction = event.target.closest(selectors.edit.editQuestionAction);\n        if (editQuestionAction) {\n            let order = [];\n            switch (editQuestionAction.dataset.action) {\n                case 'up':\n                    order = offsetQuestion(editQuestionAction.dataset.questionId, 1);\n                    break;\n                case 'down':\n                    order = offsetQuestion(editQuestionAction.dataset.questionId, -1);\n                    break;\n                case 'delete': {\n                    order = getQuestionOrder();\n                    const index = order.indexOf(editQuestionAction.dataset.questionId);\n                    if (index !== -1) {\n                        order.splice(index, 1);\n                    }\n                    break;\n                }\n                default:\n                    return;\n            }\n            submitQuestionOrder(order, courseModuleId);\n        }\n    });\n    const questionList = document.getElementsByClassName('questionlist')[0];\n    if (typeof Sortable !== 'undefined') {\n        // eslint-disable-next-line no-undef\n        Sortable.create(questionList, {\n            handle: '.dragquestion',\n            onSort: () => submitQuestionOrder(getQuestionOrder(), courseModuleId)\n        });\n    }\n    listenAddToQuiz(courseModuleId);\n}\n"],"names":["submitQuestionOrder","order","courseModuleId","post","id","action","JSON","stringify","location","reload","getQuestionOrder","document","querySelectorAll","map","question","dataset","questionId","offsetQuestion","offset","originalIndex","indexOf","i","length","addEventListener","event","editQuestionAction","target","closest","selectors","edit","index","splice","questionList","getElementsByClassName","Sortable","create","handle","onSort","querySelector","addSelectedQuestions","questionIds","checkbox","questionCheckedCheckbox","getAttribute","slice","questionids","listenAddToQuiz"],"mappings":";;;;;;;cA+BSA,oBAAoBC,MAAOC,gCAC9BC,KAAK,WAAY,CACfC,GAAIF,eACJG,OAAQ,QACRJ,MAAOK,KAAKC,UAAUN,SACvB,IAAMO,SAASC,oBAMbC,0BACaC,SAASC,iBAAiB,oBAC3BC,KAAIC,UAAYA,SAASC,QAAQC,sBAS7CC,eAAeD,WAAYE,YAC5BjB,MAAQS,mBACRS,cAAgBlB,MAAMmB,QAAQJ,gBACX,IAAnBG,qBACOlB,UAEN,IAAIoB,EAAI,EAAGA,EAAIpB,MAAMqB,OAAQD,OAC1BA,EAAIH,SAAWC,cAAe,CAC9BlB,MAAMkB,eAAiBlB,MAAMoB,GAC7BpB,MAAMoB,GAAKL,wBAIZf,2FA0BgBC,gBACvBS,SAASY,iBAAiB,SAASC,cACzBC,mBAAqBD,MAAME,OAAOC,QAAQC,mBAAUC,KAAKJ,uBAC3DA,mBAAoB,KAChBxB,MAAQ,UACJwB,mBAAmBV,QAAQV,YAC1B,KACDJ,MAAQgB,eAAeQ,mBAAmBV,QAAQC,WAAY,aAE7D,OACDf,MAAQgB,eAAeQ,mBAAmBV,QAAQC,YAAa,aAE9D,UACDf,MAAQS,yBACFoB,MAAQ7B,MAAMmB,QAAQK,mBAAmBV,QAAQC,aACxC,IAAXc,OACA7B,MAAM8B,OAAOD,MAAO,wBAOhC9B,oBAAoBC,MAAOC,0BAG7B8B,aAAerB,SAASsB,uBAAuB,gBAAgB,GAC7C,oBAAbC,UAEPA,SAASC,OAAOH,aAAc,CAC1BI,OAAQ,gBACRC,OAAQ,IAAMrC,oBAAoBU,mBAAoBR,4BAlDzCA,gBACcS,SAAS2B,cAAcV,mBAAUC,KAAKU,sBAC9ChB,iBAAiB,SAAS,eAC7CiB,YAAc,OACb,MAAMC,YAAY9B,SAASC,iBAAiBgB,mBAAUC,KAAKa,yBAC5DF,aAAeC,SAASE,aAAa,QAAQC,MAAM,GAAK,oBAE1DzC,KAAK,WAAY,CACfC,GAAIF,eACJG,OAAQ,cACRwC,YAAaL,cACd,IAAMhC,SAASC,cA0CtBqC,CAAgB5C"}