define("mod_jazzquiz/question",["exports","mod_jazzquiz/core","mod_jazzquiz/selectors","mod_jazzquiz/math_rendering"],(function(_exports,_core,_selectors,_math_rendering){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Current question.
   *
   * @module    mod_jazzquiz
   * @author    Sebastian S. Gundersen <sebastian@sgundersen.com>
   * @copyright 2024 NTNU
   * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.Question=void 0,_selectors=_interopRequireDefault(_selectors);class Question{constructor(quiz){this.quiz=quiz,this.isRunning=!1,this.isSaving=!1,this.endTime=0,this.isVoteRunning=!1,this.hasVotes=!1,this.countdownTimeLeft=0,this.questionTime=0,this.countdownInterval=0,this.timerInterval=0}refresh(){_core.Ajax.get("get_question_form",{},(data=>{if(data.is_already_submitted)return void(0,_core.setText)(document.querySelector(_selectors.default.quiz.info),"wait_for_instructor");const questionBox=document.querySelector(_selectors.default.question.box);questionBox.innerHTML=data.html,questionBox.classList.remove("hidden"),eval(data.js),data.css.forEach((cssUrl=>{let head=document.getElementsByTagName("head")[0],style=document.createElement("link");style.rel="stylesheet",style.type="text/css",style.href=cssUrl,head.appendChild(style)})),void 0!==this.quiz.role.onQuestionRefreshed&&this.quiz.role.onQuestionRefreshed(data),(0,_math_rendering.renderAllMathjax)()}))}hideTimer(){document.querySelector(_selectors.default.question.timer).classList.add("hidden"),clearInterval(this.timerInterval),this.timerInterval=0}onCountdownTick(questionTime){const quizInfo=document.querySelector(_selectors.default.quiz.info);this.countdownTimeLeft--,this.countdownTimeLeft<=0?(clearInterval(this.countdownInterval),this.countdownInterval=0,this.startAttempt(questionTime)):0!==this.countdownTimeLeft?(0,_core.setText)(quizInfo,"question_will_start_in_x_seconds","jazzquiz",this.countdownTimeLeft):(0,_core.setText)(quizInfo,"question_will_start_now")}startCountdown(questionTime,countdownTimeLeft){return 0!==this.countdownInterval||(questionTime=parseInt(questionTime),countdownTimeLeft=parseInt(countdownTimeLeft),this.countdownTimeLeft=countdownTimeLeft,countdownTimeLeft<1?!(questionTime>0&&countdownTimeLeft<-questionTime)&&(questionTime>1?this.startAttempt(questionTime+countdownTimeLeft):this.startAttempt(0),!0):(this.countdownInterval=setInterval((()=>this.onCountdownTick(questionTime)),1e3),!0))}onTimerEnding(){this.isRunning=!1,void 0!==this.quiz.role.onTimerEnding&&this.quiz.role.onTimerEnding()}onTimerTick(){const currentTime=(new Date).getTime();if(currentTime>this.endTime)this.hideTimer(),this.onTimerEnding();else{const timeLeft=(this.endTime-currentTime)/1e3;this.quiz.role.onTimerTick(Math.round(timeLeft))}}startAttempt(questionTime){document.querySelector(_selectors.default.quiz.info).classList.add("hidden"),this.refresh(),this.isRunning=!0,0!==(questionTime=parseInt(questionTime))&&(this.quiz.role.onTimerTick(questionTime),this.endTime=(new Date).getTime()+1e3*questionTime,this.timerInterval=setInterval((()=>this.onTimerTick()),1e3))}static isLoaded(){return document.querySelector(_selectors.default.question.box).innerHTML.length>0}}_exports.Question=Question}));

//# sourceMappingURL=question.min.js.map