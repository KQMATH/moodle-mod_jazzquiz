define("mod_jazzquiz/question",["exports","mod_jazzquiz/core","mod_jazzquiz/selectors"],(function(_exports,_core,_selectors){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Current question.
   *
   * @module    mod_jazzquiz
   * @author    Sebastian S. Gundersen <sebastian@sgundersen.com>
   * @copyright 2024 NTNU
   * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.Question=void 0,_selectors=_interopRequireDefault(_selectors);class Question{constructor(quiz){this.quiz=quiz,this.isRunning=!1,this.isSaving=!1,this.endTime=0,this.isVoteRunning=!1,this.hasVotes=!1,this.countdownTimeLeft=0,this.questionTime=0,this.countdownInterval=0,this.timerInterval=0}static get box(){return document.querySelector(_selectors.default.question.box)}static get timer(){return document.querySelector(_selectors.default.question.timer)}static get form(){return document.querySelector(_selectors.default.question.form)}refresh(){_core.Ajax.get("get_question_form",{},(data=>{data.is_already_submitted?(0,_core.setText)(_core.Quiz.info,"wait_for_instructor"):(_core.Quiz.show(Question.box.html(data.html)),eval(data.js),data.css.forEach((cssUrl=>{let head=document.getElementsByTagName("head")[0],style=document.createElement("link");style.rel="stylesheet",style.type="text/css",style.href=cssUrl,head.appendChild(style)})),void 0!==this.quiz.role.onQuestionRefreshed&&this.quiz.role.onQuestionRefreshed(data),_core.Quiz.renderAllMathjax())}))}hideTimer(){_core.Quiz.hide(Question.timer),clearInterval(this.timerInterval),this.timerInterval=0}onCountdownTick(questionTime){this.countdownTimeLeft--,this.countdownTimeLeft<=0?(clearInterval(this.countdownInterval),this.countdownInterval=0,this.startAttempt(questionTime)):0!==this.countdownTimeLeft?(0,_core.setText)(_core.Quiz.info,"question_will_start_in_x_seconds","jazzquiz",this.countdownTimeLeft):(0,_core.setText)(_core.Quiz.info,"question_will_start_now")}startCountdown(questionTime,countdownTimeLeft){return 0!==this.countdownInterval||(questionTime=parseInt(questionTime),countdownTimeLeft=parseInt(countdownTimeLeft),this.countdownTimeLeft=countdownTimeLeft,countdownTimeLeft<1?!(questionTime>0&&countdownTimeLeft<-questionTime)&&(questionTime>1?this.startAttempt(questionTime+countdownTimeLeft):this.startAttempt(0),!0):(this.countdownInterval=setInterval((()=>this.onCountdownTick(questionTime)),1e3),!0))}onTimerEnding(){this.isRunning=!1,void 0!==this.quiz.role.onTimerEnding&&this.quiz.role.onTimerEnding()}onTimerTick(){const currentTime=(new Date).getTime();if(currentTime>this.endTime)this.hideTimer(),this.onTimerEnding();else{const timeLeft=parseInt((this.endTime-currentTime)/1e3);this.quiz.role.onTimerTick(timeLeft)}}startAttempt(questionTime){_core.Quiz.hide(_core.Quiz.info),this.refresh(),this.isRunning=!0,0!==(questionTime=parseInt(questionTime))&&(this.quiz.role.onTimerTick(questionTime),this.endTime=(new Date).getTime()+1e3*questionTime,this.timerInterval=setInterval((()=>this.onTimerTick()),1e3))}static isLoaded(){return""!==Question.box.html()}}_exports.Question=Question}));

//# sourceMappingURL=question.min.js.map