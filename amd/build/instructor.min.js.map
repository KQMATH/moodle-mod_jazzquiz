{"version":3,"file":"instructor.min.js","sources":["../src/instructor.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module    mod_jazzquiz\n * @author    Sebastian S. Gundersen <sebastsg@stud.ntnu.no>\n * @copyright 2014 University of Wisconsin - Madison\n * @copyright 2018 NTNU\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'mod_jazzquiz/core'], function($, Jazz) {\n\n    const Quiz = Jazz.Quiz;\n    const Question = Jazz.Question;\n    const Ajax = Jazz.Ajax;\n    const setText = Jazz.setText;\n\n    class ResponseView {\n\n        /**\n         * @param {Quiz} quiz\n         */\n        constructor(quiz) {\n            this.quiz = quiz;\n            this.currentResponses = [];\n            this.showVotesUponReview = false;\n            this.respondedCount = 0;\n            this.showResponses = false;\n            this.totalStudents = 0;\n            $(document).on('click', '#jazzquiz_undo_merge', () => this.undoMerge());\n            $(document).on('click', event => {\n                // Clicking a row to merge.\n                if (event.target.classList.contains('bar')) {\n                    this.startMerge(event.target.id);\n                } else if (event.target.parentNode && event.target.parentNode.classList.contains('bar')) {\n                    this.startMerge(event.target.parentNode.id);\n                }\n            });\n            $(document).on('click', '#review_show_normal_results', () => this.refresh(false));\n            $(document).on('click', '#review_show_vote_results', () => this.refreshVotes());\n        }\n\n        /**\n         * Clear, but not hide responses.\n         */\n        clear() {\n            Quiz.responses.html('');\n            Quiz.responseInfo.html('');\n        }\n\n        /**\n         * Hides the responses\n         */\n        hide() {\n            Quiz.uncheck(Instructor.control('responses'));\n            Quiz.hide(Quiz.responses);\n            Quiz.hide(Quiz.responseInfo);\n        }\n\n        /**\n         * Shows the responses\n         */\n        show() {\n            Quiz.check(Instructor.control('responses'));\n            Quiz.show(Quiz.responses);\n            Quiz.show(Quiz.responseInfo);\n            if (this.showVotesUponReview) {\n                this.refreshVotes();\n                this.showVotesUponReview = false;\n            } else {\n                this.refresh(false);\n            }\n        }\n\n        /**\n         * Toggle whether to show or hide the responses\n         */\n        toggle() {\n            this.showResponses = !this.showResponses;\n            if (this.showResponses) {\n                this.show();\n            } else {\n                this.hide();\n            }\n        }\n\n        /**\n         * End the response merge.\n         */\n        endMerge() {\n            $('.merge-into').removeClass('merge-into');\n            $('.merge-from').removeClass('merge-from');\n        }\n\n        /**\n         * Undo the last response merge.\n         */\n        undoMerge() {\n            Ajax.post('undo_merge', {}, () => this.refresh(true));\n        }\n\n        /**\n         * Merges responses based on response string.\n         * @param {string} from\n         * @param {string} into\n         */\n        merge(from, into) {\n            Ajax.post('merge_responses', {from: from, into: into}, () => this.refresh(false));\n        }\n\n        /**\n         * Start a merge between two responses.\n         * @param {string} fromRowBarId\n         */\n        startMerge(fromRowBarId) {\n            const $barCell = $('#' + fromRowBarId);\n            let $row = $barCell.parent();\n            if ($row.hasClass('merge-from')) {\n                this.endMerge();\n                return;\n            }\n            if ($row.hasClass('merge-into')) {\n                const $fromRow = $('.merge-from');\n                this.merge($fromRow.data('response'), $row.data('response'));\n                this.endMerge();\n                return;\n            }\n            $row.addClass('merge-from');\n            let $table = $row.parent().parent();\n            $table.find('tr').each(function() {\n                const $cells = $(this).find('td');\n                if ($cells[1].id !== $barCell.attr('id')) {\n                    $(this).addClass('merge-into');\n                }\n            });\n        }\n\n        /**\n         * Create controls to toggle between the responses of the actual question and the vote that followed.\n         * @param {string} name Can be either 'vote_response' or 'current_response'\n         */\n        createControls(name) {\n            if (!this.quiz.question.hasVotes) {\n                Quiz.hide(Quiz.responseInfo);\n                return;\n            }\n            // Add button for instructor to change what to review.\n            if (this.quiz.state === 'reviewing') {\n                let $showNormalResult = $('#review_show_normal_results');\n                let $showVoteResult = $('#review_show_vote_results');\n                Quiz.show(Quiz.responseInfo);\n                if (name === 'vote_response') {\n                    if ($showNormalResult.length === 0) {\n                        setText(Quiz.responseInfo.html('<h4 class=\"inline\"></h4>').children('h4'), 'showing_vote_results');\n                        Quiz.responseInfo.append('<button id=\"review_show_normal_results\" class=\"btn btn-primary\"></button><br>');\n                        setText($('#review_show_normal_results'), 'click_to_show_original_results');\n                        $showVoteResult.remove();\n                    }\n                } else if (name === 'current_response') {\n                    if ($showVoteResult.length === 0) {\n                        setText(Quiz.responseInfo.html('<h4 class=\"inline\"></h4>').children('h4'), 'showing_original_results');\n                        Quiz.responseInfo.append('<button id=\"review_show_vote_results\" class=\"btn btn-primary\"></button><br>');\n                        setText($('#review_show_vote_results'), 'click_to_show_vote_results');\n                        $showNormalResult.remove();\n                    }\n                }\n            }\n        }\n\n        addBarGraphRow(target, name, response, i, highestResponseCount) {\n            // Const percent = (parseInt(responses[i].count) / total) * 100;\n            const percent = (parseInt(response.count) / highestResponseCount) * 100;\n\n            // Check if row with same response already exists.\n            let rowIndex = -1;\n            let currentRowIndex = -1;\n            for (let j = 0; j < target.rows.length; j++) {\n                if (target.rows[j].dataset.response === response.response) {\n                    rowIndex = parseInt(target.rows[j].dataset.rowIndex);\n                    currentRowIndex = j;\n                    break;\n                }\n            }\n\n            if (rowIndex === -1) {\n                rowIndex = target.rows.length;\n                let row = target.insertRow();\n                row.dataset.responseIndex = i;\n                row.dataset.response = response.response;\n                row.dataset.percent = percent;\n                row.dataset.rowIndex = rowIndex;\n                row.dataset.count = response.count;\n                row.classList.add('selected-vote-option');\n                if (percent < 15) {\n                    row.classList.add('outside');\n                }\n\n                const countHtml = '<span id=\"' + name + '_count_' + rowIndex + '\">' + response.count + '</span>';\n                let responseCell = row.insertCell(0);\n                responseCell.onclick = function() {\n                    $(this).parent().toggleClass('selected-vote-option');\n                };\n\n                let barCell = row.insertCell(1);\n                barCell.classList.add('bar');\n                barCell.id = name + '_bar_' + rowIndex;\n                barCell.innerHTML = '<div style=\"width:' + percent + '%;\">' + countHtml + '</div>';\n\n                const latexId = name + '_latex_' + rowIndex;\n                responseCell.innerHTML = '<span id=\"' + latexId + '\"></span>';\n                Quiz.addMathjaxElement($('#' + latexId), response.response);\n                if (response.qtype === 'stack') {\n                    Quiz.renderMaximaEquation(response.response, latexId);\n                }\n            } else {\n                let currentRow = target.rows[currentRowIndex];\n                currentRow.dataset.rowIndex = rowIndex;\n                currentRow.dataset.responseIndex = i;\n                currentRow.dataset.percent = percent;\n                currentRow.dataset.count = response.count;\n                const containsOutside = currentRow.classList.contains('outside');\n                if (percent > 15 && containsOutside) {\n                    currentRow.classList.remove('outside');\n                } else if (percent < 15 && !containsOutside) {\n                    currentRow.classList.add('outside');\n                }\n                let countElement = document.getElementById(name + '_count_' + rowIndex);\n                if (countElement !== null) {\n                    countElement.innerHTML = response.count;\n                }\n                let barElement = document.getElementById(name + '_bar_' + rowIndex);\n                if (barElement !== null) {\n                    barElement.firstElementChild.style.width = percent + '%';\n                }\n            }\n        }\n\n        /**\n         * Create a new and unsorted response bar graph.\n         *\n         * @param {Array.<Object>} responses\n         * @param {string} name\n         * @param {string} targetId\n         * @param {string} graphId\n         * @param {boolean} rebuild If the table should be completely rebuilt or not\n         */\n        createBarGraph(responses, name, targetId, graphId, rebuild) {\n            let target = document.getElementById(targetId);\n            if (target === null) {\n                return;\n            }\n            let highestResponseCount = 0;\n            for (let i = 0; i < responses.length; i++) {\n                let count = parseInt(responses[i].count); // In case count is a string.\n                if (count > highestResponseCount) {\n                    highestResponseCount = count;\n                }\n            }\n\n            // Remove the rows if it should be rebuilt.\n            if (rebuild) {\n                target.innerHTML = '';\n            }\n\n            // Prune rows.\n            for (let i = 0; i < target.rows.length; i++) {\n                let prune = true;\n                for (let j = 0; j < responses.length; j++) {\n                    if (target.rows[i].dataset.response === responses[j].response) {\n                        prune = false;\n                        break;\n                    }\n                }\n                if (prune) {\n                    target.deleteRow(i);\n                    i--;\n                }\n            }\n\n            // Add rows.\n            this.createControls(name);\n            name += graphId;\n            for (let i = 0; i < responses.length; i++) {\n                this.addBarGraphRow(target, name, responses[i], i, highestResponseCount);\n            }\n        }\n\n        /**\n         * Sort the responses in the graph by how many had the same response.\n         * @param {string} targetId\n         */\n        static sortBarGraph(targetId) {\n            let target = document.getElementById(targetId);\n            if (target === null) {\n                return;\n            }\n            let isSorting = true;\n            while (isSorting) {\n                isSorting = false;\n                for (let i = 0; i < (target.rows.length - 1); i++) {\n                    const current = parseInt(target.rows[i].dataset.percent);\n                    const next = parseInt(target.rows[i + 1].dataset.percent);\n                    if (current < next) {\n                        target.rows[i].parentNode.insertBefore(target.rows[i + 1], target.rows[i]);\n                        isSorting = true;\n                        break;\n                    }\n                }\n            }\n        }\n\n        /**\n         * Create and sort a bar graph based on the responses passed.\n         * @param {string} wrapperId\n         * @param {string} tableId\n         * @param {Array.<Object>} responses\n         * @param {number|undefined} responded How many students responded to the question\n         * @param {string} questionType\n         * @param {string} graphId\n         * @param {boolean} rebuild If the graph should be rebuilt or not.\n         */\n        set(wrapperId, tableId, responses, responded, questionType, graphId, rebuild) {\n            if (responses === undefined) {\n                return;\n            }\n\n            // Check if any responses to show.\n            if (responses.length === 0) {\n                Quiz.show(Quiz.responded);\n                setText(Quiz.responded.find('h4'), 'a_out_of_b_responded', 'jazzquiz', {\n                    a: 0,\n                    b: this.totalStudents\n                });\n                return;\n            }\n\n            // Question type specific.\n            switch (questionType) {\n                case 'shortanswer':\n                    for (let i = 0; i < responses.length; i++) {\n                        responses[i].response = responses[i].response.trim();\n                    }\n                    break;\n                case 'stack':\n                    // Remove all spaces from responses.\n                    for (let i = 0; i < responses.length; i++) {\n                        responses[i].response = responses[i].response.replace(/\\s/g, '');\n                    }\n                    break;\n                default:\n                    break;\n            }\n\n            // Update data.\n            this.currentResponses = [];\n            this.respondedCount = 0;\n            for (let i = 0; i < responses.length; i++) {\n                let exists = false;\n                let count = 1;\n                if (responses[i].count !== undefined) {\n                    count = parseInt(responses[i].count);\n                }\n                this.respondedCount += count;\n                // Check if response is a duplicate.\n                for (let j = 0; j < this.currentResponses.length; j++) {\n                    if (this.currentResponses[j].response === responses[i].response) {\n                        this.currentResponses[j].count += count;\n                        exists = true;\n                        break;\n                    }\n                }\n                // Add element if not a duplicate.\n                if (!exists) {\n                    this.currentResponses.push({\n                        response: responses[i].response,\n                        count: count,\n                        qtype: questionType\n                    });\n                }\n            }\n\n            // Update responded container.\n            if (Quiz.responded.length !== 0 && responded !== undefined) {\n                Quiz.show(Quiz.responded);\n                setText(Quiz.responded.find('h4'), 'a_out_of_b_responded', 'jazzquiz', {\n                    a: responded,\n                    b: this.totalStudents\n                });\n            }\n\n            // Should we show the responses?\n            if (!this.showResponses && this.quiz.state !== 'reviewing') {\n                Quiz.hide(Quiz.responseInfo);\n                Quiz.hide(Quiz.responses);\n                return;\n            }\n\n            if (document.getElementById(tableId) === null) {\n                const html = '<table id=\"' + tableId + '\" class=\"jazzquiz-responses-overview\"></table>';\n                Quiz.show($('#' + wrapperId).html(html));\n            }\n            this.createBarGraph(this.currentResponses, 'current_response', tableId, graphId, rebuild);\n            ResponseView.sortBarGraph(tableId);\n        }\n\n        /**\n         * Fetch and show results for the ongoing or previous question.\n         * @param {boolean} rebuild If the response graph should be rebuilt or not.\n         */\n        refresh(rebuild) {\n            Ajax.get('get_results', {}, data => {\n                this.quiz.question.hasVotes = data.has_votes;\n                this.totalStudents = parseInt(data.total_students);\n\n                this.set('jazzquiz_responses_container', 'current_responses_wrapper',\n                    data.responses, data.responded, data.question_type, 'results', rebuild);\n\n                if (data.merge_count > 0) {\n                    Quiz.show($('#jazzquiz_undo_merge'));\n                } else {\n                    Quiz.hide($('#jazzquiz_undo_merge'));\n                }\n            });\n        }\n\n        /**\n         * Method refresh() equivalent for votes.\n         */\n        refreshVotes() {\n            // Should we show the results?\n            if (!this.showResponses && this.quiz.state !== 'reviewing') {\n                Quiz.hide(Quiz.responseInfo);\n                Quiz.hide(Quiz.responses);\n                return;\n            }\n            Ajax.get('get_vote_results', {}, data => {\n                const answers = data.answers;\n                const targetId = 'wrapper_vote_responses';\n                let responses = [];\n\n                this.respondedCount = 0;\n                this.totalStudents = parseInt(data.total_students);\n\n                for (let i in answers) {\n                    if (!answers.hasOwnProperty(i)) {\n                        continue;\n                    }\n                    responses.push({\n                        response: answers[i].attempt,\n                        count: answers[i].finalcount,\n                        qtype: answers[i].qtype,\n                        slot: answers[i].slot\n                    });\n                    this.respondedCount += parseInt(answers[i].finalcount);\n                }\n\n                setText(Quiz.responded.find('h4'), 'a_out_of_b_voted', 'jazzquiz', {\n                    a: this.respondedCount,\n                    b: this.totalStudents\n                });\n\n                if (document.getElementById(targetId) === null) {\n                    const html = '<table id=\"' + targetId + '\" class=\"jazzquiz-responses-overview\"></table>';\n                    Quiz.show(Quiz.responses.html(html));\n                }\n\n                this.createBarGraph(responses, 'vote_response', targetId, 'vote', false);\n                ResponseView.sortBarGraph(targetId);\n            });\n        }\n\n    }\n\n    class Instructor {\n\n        /**\n         * @param {Quiz} quiz\n         */\n        constructor(quiz) {\n            this.quiz = quiz;\n            this.responses = new ResponseView(quiz);\n            this.isShowingCorrectAnswer = false;\n            this.totalQuestions = 0;\n            this.allowVote = false;\n\n            $(document).on('keyup', event => {\n                if (event.keyCode === 27) { // Escape key.\n                    Instructor.closeFullscreenView();\n                }\n            });\n\n            $(document).on('click', event => {\n                Instructor.closeQuestionListMenu(event, 'improvise');\n                Instructor.closeQuestionListMenu(event, 'jump');\n            });\n\n            Instructor.addEvents({\n                'repoll': () => this.repollQuestion(),\n                'vote': () => this.runVoting(),\n                'improvise': () => this.showQuestionListSetup('improvise'),\n                'jump': () => this.showQuestionListSetup('jump'),\n                'next': () => this.nextQuestion(),\n                'random': () => this.randomQuestion(),\n                'end': () => this.endQuestion(),\n                'fullscreen': () => Instructor.showFullscreenView(),\n                'answer': () => this.showCorrectAnswer(),\n                'responses': () => this.responses.toggle(),\n                'exit': () => this.closeSession(),\n                'quit': () => this.closeSession(),\n                'startquiz': () => this.startQuiz()\n            });\n\n            Instructor.addHotkeys({\n                't': 'responses',\n                'r': 'repoll',\n                'a': 'answer',\n                'e': 'end',\n                'j': 'jump',\n                'i': 'improvise',\n                'v': 'vote',\n                'n': 'next',\n                'm': 'random',\n                'f': 'fullscreen'\n            });\n        }\n\n        static addHotkeys(keys) {\n            for (let key in keys) {\n                if (keys.hasOwnProperty(key)) {\n                    keys[key] = {\n                        action: keys[key],\n                        repeat: false // TODO: Maybe event.repeat becomes more standard?\n                    };\n                    $(document).on('keydown', event => {\n                        if (keys[key].repeat || event.ctrlKey) {\n                            return;\n                        }\n                        if (String.fromCharCode(event.which).toLowerCase() !== key) {\n                            return;\n                        }\n                        let focusedTag = $(':focus').prop('tagName');\n                        if (focusedTag !== undefined) {\n                            focusedTag = focusedTag.toLowerCase();\n                            if (focusedTag === 'input' || focusedTag === 'textarea') {\n                                return;\n                            }\n                        }\n                        event.preventDefault();\n                        keys[key].repeat = true;\n                        let $control = Instructor.control(keys[key].action);\n                        if ($control.length && !$control.prop('disabled')) {\n                            $control.click();\n                        }\n                    });\n                    $(document).on('keyup', event => {\n                        if (String.fromCharCode(event.which).toLowerCase() === key) {\n                            keys[key].repeat = false;\n                        }\n                    });\n                }\n            }\n        }\n\n        static addEvents(events) {\n            for (let key in events) {\n                if (events.hasOwnProperty(key)) {\n                    $(document).on('click', '#jazzquiz_control_' + key, () => {\n                        Instructor.enableControls([]);\n                        events[key]();\n                    });\n                }\n            }\n        }\n\n        static get controls() {\n            return $('#jazzquiz_controls_box');\n        }\n\n        static get controlButtons() {\n            return Instructor.controls.find('.quiz-control-buttons');\n        }\n\n        static control(key) {\n            return $('#jazzquiz_control_' + key);\n        }\n\n        static get side() {\n            return $('#jazzquiz_side_container');\n        }\n\n        static get correctAnswer() {\n            return $('#jazzquiz_correct_answer_container');\n        }\n\n        static get isMerging() {\n            return $('.merge-from').length !== 0;\n        }\n\n        onNotRunning(data) {\n            this.responses.totalStudents = data.student_count;\n            Quiz.hide(Instructor.side);\n            setText(Quiz.info, 'instructions_for_instructor');\n            Instructor.enableControls([]);\n            Quiz.hide(Instructor.controlButtons);\n            let $studentsJoined = Instructor.control('startquiz').next();\n            if (data.student_count === 1) {\n                setText($studentsJoined, 'one_student_has_joined');\n            } else if (data.student_count > 1) {\n                setText($studentsJoined, 'x_students_have_joined', 'jazzquiz', data.student_count);\n            } else {\n                setText($studentsJoined, 'no_students_have_joined');\n            }\n            Quiz.show(Instructor.control('startquiz').parent());\n        }\n\n        onPreparing(data) {\n            Quiz.hide(Instructor.side);\n            setText(Quiz.info, 'instructions_for_instructor');\n            let enabledButtons = ['improvise', 'jump', 'random', 'fullscreen', 'quit'];\n            if (data.slot < this.totalQuestions) {\n                enabledButtons.push('next');\n            }\n            Instructor.enableControls(enabledButtons);\n        }\n\n        onRunning(data) {\n            if (!this.responses.showResponses) {\n                this.responses.hide();\n            }\n            Quiz.show(Instructor.side);\n            Instructor.enableControls(['end', 'responses', 'fullscreen']);\n            this.quiz.question.questionTime = data.questiontime;\n            if (this.quiz.question.isRunning) {\n                // Check if the question has already ended.\n                // We need to do this because the state does not update unless an instructor is connected.\n                if (data.questionTime > 0 && data.delay < -data.questiontime) {\n                    this.endQuestion();\n                }\n                // Only rebuild results if we are not merging.\n                this.responses.refresh(!Instructor.isMerging);\n            } else {\n                const started = this.quiz.question.startCountdown(data.questiontime, data.delay);\n                if (started) {\n                    this.quiz.question.isRunning = true;\n                }\n            }\n        }\n\n        onReviewing(data) {\n            Quiz.show(Instructor.side);\n            let enabledButtons = ['answer', 'repoll', 'fullscreen', 'improvise', 'jump', 'random', 'quit'];\n            if (this.allowVote) {\n                enabledButtons.push('vote');\n            }\n            if (data.slot < this.totalQuestions) {\n                enabledButtons.push('next');\n            }\n            Instructor.enableControls(enabledButtons);\n\n            // In case page was refreshed, we should ensure the question is showing.\n            if (!Question.isLoaded()) {\n                this.quiz.question.refresh();\n            }\n\n            // For now, just always show responses while reviewing.\n            // In the future, there should be an additional toggle.\n            if (this.quiz.isNewState) {\n                this.responses.show();\n            }\n            // No longer in question.\n            this.quiz.question.isRunning = false;\n        }\n\n        onSessionClosed() {\n            Quiz.hide(Instructor.side);\n            Quiz.hide(Instructor.correctAnswer);\n            Instructor.enableControls([]);\n            this.responses.clear();\n            this.quiz.question.isRunning = false;\n        }\n\n        onVoting() {\n            if (!this.responses.showResponses) {\n                this.responses.hide();\n            }\n            Quiz.show(Instructor.side);\n            Instructor.enableControls(['quit', 'fullscreen', 'answer', 'responses', 'end']);\n            this.responses.refreshVotes();\n        }\n\n        onStateChange() {\n            $('#region-main').find('ul.nav.nav-tabs').css('display', 'none');\n            $('#region-main-settings-menu').css('display', 'none');\n            $('.region_main_settings_menu_proxy').css('display', 'none');\n            Quiz.show(Instructor.controlButtons);\n            Quiz.hide(Instructor.control('startquiz').parent());\n        }\n\n        onQuestionRefreshed(data) {\n            this.allowVote = data.voteable;\n        }\n\n        onTimerEnding() {\n            this.endQuestion();\n        }\n\n        onTimerTick(timeLeft) {\n            setText(Question.timer, 'x_seconds_left', 'jazzquiz', timeLeft);\n        }\n\n        /**\n         * Start the quiz. Does not start any questions.\n         */\n        startQuiz() {\n            Quiz.hide(Instructor.control('startquiz').parent());\n            Ajax.post('start_quiz', {}, () => $('#jazzquiz_controls').removeClass('btn-hide'));\n        }\n\n        /**\n         * End the currently ongoing question or vote.\n         */\n        endQuestion() {\n            this.quiz.question.hideTimer();\n            Ajax.post('end_question', {}, () => {\n                if (this.quiz.state === 'voting') {\n                    this.responses.showVotesUponReview = true;\n                } else {\n                    this.quiz.question.isRunning = false;\n                    Instructor.enableControls([]);\n                }\n            });\n        }\n\n        /**\n         * Show a question list dropdown.\n         * @param {string} name\n         */\n        showQuestionListSetup(name) {\n            let $controlButton = Instructor.control(name);\n            if ($controlButton.hasClass('active')) {\n                // It's already open. Let's not send another request.\n                return;\n            }\n            Ajax.get('list_' + name + '_questions', {}, data => {\n                let self = this;\n                let $menu = $('#jazzquiz_' + name + '_menu');\n                const menuMargin = $controlButton.offset().left - $controlButton.parent().offset().left;\n                $menu.html('').addClass('active').css('margin-left', menuMargin + 'px');\n                $controlButton.addClass('active');\n                const questions = data.questions;\n                for (let i in questions) {\n                    if (!questions.hasOwnProperty(i)) {\n                        continue;\n                    }\n                    let $questionButton = $('<button class=\"btn\"></button>');\n                    Quiz.addMathjaxElement($questionButton, questions[i].name);\n                    $questionButton.data({\n                        'time': questions[i].time,\n                        'question-id': questions[i].questionid,\n                        'jazzquiz-question-id': questions[i].jazzquizquestionid\n                    });\n                    $questionButton.data('test', 1);\n                    $questionButton.on('click', function() {\n                        const questionId = $(this).data('question-id');\n                        const time = $(this).data('time');\n                        const jazzQuestionId = $(this).data('jazzquiz-question-id');\n                        self.jumpQuestion(questionId, time, jazzQuestionId);\n                        $menu.html('').removeClass('active');\n                        $controlButton.removeClass('active');\n                    });\n                    $menu.append($questionButton);\n                }\n            });\n        }\n\n        /**\n         * Get the selected responses.\n         * @returns {Array.<Object>} Vote options\n         */\n        static getSelectedAnswersForVote() {\n            let result = [];\n            $('.selected-vote-option').each((i, option) => {\n                result.push({\n                    text: option.dataset.response,\n                    count: option.dataset.count\n                });\n            });\n            return result;\n        }\n\n        /**\n         * Start a vote with the responses that are currently selected.\n         */\n        runVoting() {\n            const options = Instructor.getSelectedAnswersForVote();\n            const data = {questions: encodeURIComponent(JSON.stringify(options))};\n            Ajax.post('run_voting', data);\n        }\n\n        /**\n         * Start a new question in this session.\n         * @param {string} method\n         * @param {number} questionId\n         * @param {number} questionTime\n         * @param {number} jazzquizQuestionId\n         */\n        startQuestion(method, questionId, questionTime, jazzquizQuestionId) {\n            Quiz.hide(Quiz.info);\n            this.responses.clear();\n            this.hideCorrectAnswer();\n            Ajax.post('start_question', {\n                method: method,\n                questionid: questionId,\n                questiontime: questionTime,\n                jazzquizquestionid: jazzquizQuestionId\n            }, data => this.quiz.question.startCountdown(data.questiontime, data.delay));\n        }\n\n        /**\n         * Jump to a planned question in the quiz.\n         * @param {number} questionId\n         * @param {number} questionTime\n         * @param {number} jazzquizQuestionId\n         */\n        jumpQuestion(questionId, questionTime, jazzquizQuestionId) {\n            this.startQuestion('jump', questionId, questionTime, jazzquizQuestionId);\n        }\n\n        /**\n         * Repoll the previously asked question.\n         */\n        repollQuestion() {\n            this.startQuestion('repoll', 0, 0, 0);\n        }\n\n        /**\n         * Continue on to the next preplanned question.\n         */\n        nextQuestion() {\n            this.startQuestion('next', 0, 0, 0);\n        }\n\n        /**\n         * Start a random question.\n         */\n        randomQuestion() {\n            this.startQuestion('random', 0, 0, 0);\n        }\n\n        /**\n         * Close the current session.\n         */\n        closeSession() {\n            Quiz.hide($('#jazzquiz_undo_merge'));\n            Quiz.hide(Question.box);\n            Quiz.hide(Instructor.controls);\n            setText(Quiz.info, 'closing_session');\n            // eslint-disable-next-line no-return-assign\n            Ajax.post('close_session', {}, () => window.location = location.href.split('&')[0]);\n        }\n\n        /**\n         * Hide the correct answer if showing.\n         */\n        hideCorrectAnswer() {\n            if (this.isShowingCorrectAnswer) {\n                Quiz.hide(Instructor.correctAnswer);\n                Quiz.uncheck(Instructor.control('answer'));\n                this.isShowingCorrectAnswer = false;\n            }\n        }\n\n        /**\n         * Request and show the correct answer for the ongoing or previous question.\n         */\n        showCorrectAnswer() {\n            this.hideCorrectAnswer();\n            Ajax.get('get_right_response', {}, data => {\n                Quiz.show(Instructor.correctAnswer.html(data.right_answer));\n                Quiz.renderAllMathjax();\n                Quiz.check(Instructor.control('answer'));\n                this.isShowingCorrectAnswer = true;\n            });\n        }\n\n        /**\n         * Enables all buttons passed in arguments, but disables all others.\n         * @param {Array.<string>} buttons The unique part of the IDs of the buttons to be enabled.\n         */\n        static enableControls(buttons) {\n            Instructor.controlButtons.children('button').each((index, child) => {\n                const id = child.getAttribute('id').replace('jazzquiz_control_', '');\n                child.disabled = (buttons.indexOf(id) === -1);\n            });\n        }\n\n        /**\n         * Enter fullscreen mode for better use with projectors.\n         */\n        static showFullscreenView() {\n            if (Quiz.main.hasClass('jazzquiz-fullscreen')) {\n                Instructor.closeFullscreenView();\n                return;\n            }\n            // Hide the scrollbar - remember to always set back to auto when closing.\n            document.documentElement.style.overflowY = 'hidden';\n            // Sets the quiz view to an absolute position that covers the viewport.\n            Quiz.main.addClass('jazzquiz-fullscreen');\n        }\n\n        /**\n         * Exit the fullscreen mode.\n         */\n        static closeFullscreenView() {\n            document.documentElement.style.overflowY = 'auto';\n            Quiz.main.removeClass('jazzquiz-fullscreen');\n        }\n\n        /**\n         * Close the dropdown menu for choosing a question.\n         * @param {Event} event\n         * @param {string} name\n         */\n        static closeQuestionListMenu(event, name) {\n            const menuId = '#jazzquiz_' + name + '_menu';\n            // Close the menu if the click was not inside.\n            const menu = $(event.target).closest(menuId);\n            if (!menu.length) {\n                $(menuId).html('').removeClass('active');\n                Instructor.control(name).removeClass('active');\n            }\n        }\n\n        static addReportEventHandlers() {\n            $(document).on('click', '#report_overview_controls button', function() {\n                const action = $(this).data('action');\n                if (action === 'attendance') {\n                    $('#report_overview_responded').fadeIn();\n                    $('#report_overview_responses').fadeOut();\n                } else if (action === 'responses') {\n                    $('#report_overview_responses').fadeIn();\n                    $('#report_overview_responded').fadeOut();\n                }\n            });\n        }\n\n    }\n\n    return {\n        initialize: function(totalQuestions, reportView, slots) {\n            let quiz = new Quiz(Instructor);\n            quiz.role.totalQuestions = totalQuestions;\n            if (reportView) {\n                Instructor.addReportEventHandlers();\n                quiz.role.responses.showResponses = true;\n                slots.forEach(slot => {\n                    const wrapper = 'jazzquiz_wrapper_responses_' + slot.num;\n                    const table = 'responses_wrapper_table_' + slot.num;\n                    const graph = 'report_' + slot.num;\n                    quiz.role.responses.set(wrapper, table, slot.responses, undefined, slot.type, graph, false);\n                });\n            } else {\n                quiz.poll(500);\n            }\n        }\n    };\n\n});\n"],"names":["define","$","Jazz","Quiz","Question","Ajax","setText","ResponseView","constructor","quiz","currentResponses","showVotesUponReview","respondedCount","showResponses","totalStudents","document","on","this","undoMerge","event","target","classList","contains","startMerge","id","parentNode","refresh","refreshVotes","clear","responses","html","responseInfo","hide","uncheck","Instructor","control","show","check","toggle","endMerge","removeClass","post","merge","from","into","fromRowBarId","$barCell","$row","parent","hasClass","$fromRow","data","addClass","find","each","attr","createControls","name","question","hasVotes","state","$showNormalResult","$showVoteResult","length","children","append","remove","addBarGraphRow","response","i","highestResponseCount","percent","parseInt","count","rowIndex","currentRowIndex","j","rows","dataset","row","insertRow","responseIndex","add","countHtml","responseCell","insertCell","onclick","toggleClass","barCell","innerHTML","latexId","addMathjaxElement","qtype","renderMaximaEquation","currentRow","containsOutside","countElement","getElementById","barElement","firstElementChild","style","width","createBarGraph","targetId","graphId","rebuild","prune","deleteRow","isSorting","insertBefore","set","wrapperId","tableId","responded","questionType","undefined","a","b","trim","replace","exists","push","sortBarGraph","get","has_votes","total_students","question_type","merge_count","answers","hasOwnProperty","attempt","finalcount","slot","isShowingCorrectAnswer","totalQuestions","allowVote","keyCode","closeFullscreenView","closeQuestionListMenu","addEvents","repollQuestion","runVoting","showQuestionListSetup","nextQuestion","randomQuestion","endQuestion","showFullscreenView","showCorrectAnswer","closeSession","startQuiz","addHotkeys","keys","key","action","repeat","ctrlKey","String","fromCharCode","which","toLowerCase","focusedTag","prop","preventDefault","$control","click","events","enableControls","controls","controlButtons","side","correctAnswer","isMerging","onNotRunning","student_count","info","$studentsJoined","next","onPreparing","enabledButtons","onRunning","questionTime","questiontime","isRunning","delay","startCountdown","onReviewing","isLoaded","isNewState","onSessionClosed","onVoting","onStateChange","css","onQuestionRefreshed","voteable","onTimerEnding","onTimerTick","timeLeft","timer","hideTimer","$controlButton","self","$menu","menuMargin","offset","left","questions","$questionButton","time","questionid","jazzquizquestionid","questionId","jazzQuestionId","jumpQuestion","result","option","text","options","getSelectedAnswersForVote","encodeURIComponent","JSON","stringify","startQuestion","method","jazzquizQuestionId","hideCorrectAnswer","box","window","location","href","split","right_answer","renderAllMathjax","buttons","index","child","getAttribute","disabled","indexOf","main","documentElement","overflowY","menuId","closest","fadeIn","fadeOut","initialize","reportView","slots","role","addReportEventHandlers","forEach","wrapper","num","table","graph","type","poll"],"mappings":"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"}