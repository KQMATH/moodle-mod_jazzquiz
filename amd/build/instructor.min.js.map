{"version":3,"file":"instructor.min.js","sources":["../src/instructor.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module    mod_jazzquiz\n * @author    Sebastian S. Gundersen <sebastian@sgundersen.com>\n * @copyright 2014 University of Wisconsin - Madison\n * @copyright 2018 NTNU\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport {Quiz, Ajax, setText} from 'mod_jazzquiz/core';\nimport {Question} from 'mod_jazzquiz/question';\nimport selectors from 'mod_jazzquiz/selectors';\n\nclass ResponseView {\n\n    /**\n     * @param {Quiz} quiz\n     */\n    constructor(quiz) {\n        this.quiz = quiz;\n        this.currentResponses = [];\n        this.showVotesUponReview = false;\n        this.respondedCount = 0;\n        this.showResponses = false;\n        this.totalStudents = 0;\n\n        document.addEventListener('click', event => {\n            const undoMergeButton = event.target.closest(selectors.quiz.undoMergeButton);\n            if (undoMergeButton) {\n                this.undoMerge();\n            }\n\n            const showNormalResultsButton = event.target.closest(selectors.quiz.showNormalResultsButton);\n            if (showNormalResultsButton) {\n                this.refresh(false);\n            }\n\n            const showVoteResultsButton = event.target.closest(selectors.quiz.showVoteResultsButton);\n            if (showVoteResultsButton) {\n                this.refreshVotes();\n            }\n\n            // Clicking a row to merge.\n            if (event.target.classList.contains('bar')) {\n                this.startMerge(event.target.id);\n            } else if (event.target.parentNode && event.target.parentNode.classList.contains('bar')) {\n                this.startMerge(event.target.parentNode.id);\n            }\n        });\n    }\n\n    /**\n     * Clear, but not hide responses.\n     */\n    clear() {\n        document.querySelector(selectors.quiz.responses).innerHTML = '';\n        document.querySelector(selectors.quiz.responseInfo).innerHTML = '';\n    }\n\n    /**\n     * Hides the responses\n     */\n    hide() {\n        Instructor.control('responses').querySelector('.fa').classList.replace('fa-check-square-o', 'fa-square-o');\n        document.querySelector(selectors.quiz.responses).classList.add('hidden');\n        document.querySelector(selectors.quiz.responseInfo).classList.add('hidden');\n    }\n\n    /**\n     * Shows the responses\n     */\n    show() {\n        Instructor.control('responses').querySelector('.fa').classList.replace('fa-square-o', 'fa-check-square-o');\n        document.querySelector(selectors.quiz.responses).classList.remove('hidden');\n        document.querySelector(selectors.quiz.responseInfo).classList.remove('hidden');\n        if (this.showVotesUponReview) {\n            this.refreshVotes();\n            this.showVotesUponReview = false;\n        } else {\n            this.refresh(false);\n        }\n    }\n\n    /**\n     * Toggle whether to show or hide the responses\n     */\n    toggle() {\n        this.showResponses = !this.showResponses;\n        if (this.showResponses) {\n            this.show();\n        } else {\n            this.hide();\n        }\n    }\n\n    /**\n     * End the response merge.\n     */\n    endMerge() {\n        document.querySelectorAll(selectors.quiz.mergeInto).forEach(element => element.classList.remove('merge-into'));\n        document.querySelectorAll(selectors.quiz.mergeFrom).forEach(element => element.classList.remove('merge-from'));\n    }\n\n    /**\n     * Undo the last response merge.\n     */\n    undoMerge() {\n        Ajax.post('undo_merge', {}, () => this.refresh(true));\n    }\n\n    /**\n     * Merges responses based on response string.\n     * @param {string} from\n     * @param {string} into\n     */\n    merge(from, into) {\n        Ajax.post('merge_responses', {from: from, into: into}, () => this.refresh(false));\n    }\n\n    /**\n     * Start a merge between two responses.\n     * @param {string} fromRowBarId\n     */\n    startMerge(fromRowBarId) {\n        const barCell = document.getElementById(fromRowBarId);\n        const row = barCell.parentElement;\n        if (row.classList.contains('merge-from')) {\n            this.endMerge();\n            return;\n        }\n        if (row.classList.contains('merge-into')) {\n            const fromRow = document.querySelector(selectors.quiz.mergeFrom);\n            this.merge(fromRow.dataset.response, row.dataset.response);\n            this.endMerge();\n            return;\n        }\n        row.classList.add('merge-from');\n        row.closest('table').querySelectorAll('tr').forEach(tableRow => {\n            const cell = tableRow.querySelector('td:nth-child(2)');\n            if (cell && cell.id !== barCell.id) {\n                tableRow.classList.add('merge-into');\n            }\n        });\n    }\n\n    /**\n     * Create controls to toggle between the responses of the actual question and the vote that followed.\n     * @param {string} name Can be either 'vote_response' or 'current_response'\n     */\n    createControls(name) {\n        const quizResponseInfo = document.querySelector(selectors.quiz.responseInfo);\n        if (!this.quiz.question.hasVotes) {\n            quizResponseInfo.classList.add('hidden');\n            return;\n        }\n        // Add button for instructor to change what to review.\n        if (this.quiz.state === 'reviewing') {\n            let showNormalResult = document.querySelector(selectors.quiz.showNormalResultsButton);\n            let showVoteResult = document.querySelector(selectors.quiz.showVoteResultsButton);\n            quizResponseInfo.classList.remove('hidden');\n            if (name === 'vote_response') {\n                if (!showNormalResult) {\n                    setText(quizResponseInfo.html('<h4 class=\"inline\"></h4>').children('h4'), 'showing_vote_results');\n                    quizResponseInfo.innerHTML += '<button id=\"review_show_normal_results\" class=\"btn btn-primary\"></button><br>';\n                    showNormalResult = document.querySelector(selectors.quiz.showNormalResultsButton);\n                    setText(showNormalResult, 'click_to_show_original_results');\n                    showVoteResult.remove();\n                }\n            } else if (name === 'current_response') {\n                if (!showVoteResult) {\n                    quizResponseInfo.innerHTML = '<h4 class=\"inline\"></h4>';\n                    setText(quizResponseInfo.querySelector('h4'), 'showing_original_results');\n                    quizResponseInfo.innerHTML += '<button id=\"review_show_vote_results\" class=\"btn btn-primary\"></button><br>';\n                    showVoteResult = document.querySelector(selectors.quiz.showVoteResultsButton);\n                    setText(showVoteResult, 'click_to_show_vote_results');\n                    showNormalResult.remove();\n                }\n            }\n        }\n    }\n\n    addBarGraphRow(target, name, response, i, highestResponseCount) {\n        // Const percent = (parseInt(responses[i].count) / total) * 100;\n        const percent = (parseInt(response.count) / highestResponseCount) * 100;\n\n        // Check if row with same response already exists.\n        let rowIndex = -1;\n        let currentRowIndex = -1;\n        for (let j = 0; j < target.rows.length; j++) {\n            if (target.rows[j].dataset.response === response.response) {\n                rowIndex = parseInt(target.rows[j].dataset.rowIndex);\n                currentRowIndex = j;\n                break;\n            }\n        }\n\n        if (rowIndex === -1) {\n            rowIndex = target.rows.length;\n            let row = target.insertRow();\n            row.dataset.responseIndex = i;\n            row.dataset.response = response.response;\n            row.dataset.percent = percent;\n            row.dataset.rowIndex = rowIndex;\n            row.dataset.count = response.count;\n            row.classList.add('selected-vote-option');\n            if (percent < 15) {\n                row.classList.add('outside');\n            }\n\n            const countHtml = '<span id=\"' + name + '_count_' + rowIndex + '\">' + response.count + '</span>';\n            let responseCell = row.insertCell(0);\n            responseCell.onclick = () => responseCell.parentElement.classList.toggle('selected-vote-option');\n\n            let barCell = row.insertCell(1);\n            barCell.classList.add('bar');\n            barCell.id = name + '_bar_' + rowIndex;\n            barCell.innerHTML = '<div style=\"width:' + percent + '%;\">' + countHtml + '</div>';\n\n            const latexId = name + '_latex_' + rowIndex;\n            responseCell.innerHTML = '<span id=\"' + latexId + '\"></span>';\n            Quiz.addMathjaxElement(document.getElementById(latexId), response.response);\n            if (response.qtype === 'stack') {\n                Quiz.renderMaximaEquation(response.response, latexId);\n            }\n        } else {\n            let currentRow = target.rows[currentRowIndex];\n            currentRow.dataset.rowIndex = rowIndex;\n            currentRow.dataset.responseIndex = i;\n            currentRow.dataset.percent = percent;\n            currentRow.dataset.count = response.count;\n            const containsOutside = currentRow.classList.contains('outside');\n            if (percent > 15 && containsOutside) {\n                currentRow.classList.remove('outside');\n            } else if (percent < 15 && !containsOutside) {\n                currentRow.classList.add('outside');\n            }\n            let countElement = document.getElementById(name + '_count_' + rowIndex);\n            if (countElement !== null) {\n                countElement.innerHTML = response.count;\n            }\n            let barElement = document.getElementById(name + '_bar_' + rowIndex);\n            if (barElement !== null) {\n                barElement.firstElementChild.style.width = percent + '%';\n            }\n        }\n    }\n\n    /**\n     * Create a new and unsorted response bar graph.\n     *\n     * @param {Array.<Object>} responses\n     * @param {string} name\n     * @param {string} targetId\n     * @param {string} graphId\n     * @param {boolean} rebuild If the table should be completely rebuilt or not\n     */\n    createBarGraph(responses, name, targetId, graphId, rebuild) {\n        let target = document.getElementById(targetId);\n        if (target === null) {\n            return;\n        }\n        let highestResponseCount = 0;\n        for (let i = 0; i < responses.length; i++) {\n            let count = parseInt(responses[i].count); // In case count is a string.\n            if (count > highestResponseCount) {\n                highestResponseCount = count;\n            }\n        }\n\n        // Remove the rows if it should be rebuilt.\n        if (rebuild) {\n            target.innerHTML = '';\n        }\n\n        // Prune rows.\n        for (let i = 0; i < target.rows.length; i++) {\n            let prune = true;\n            for (let j = 0; j < responses.length; j++) {\n                if (target.rows[i].dataset.response === responses[j].response) {\n                    prune = false;\n                    break;\n                }\n            }\n            if (prune) {\n                target.deleteRow(i);\n                i--;\n            }\n        }\n\n        // Add rows.\n        this.createControls(name);\n        name += graphId;\n        for (let i = 0; i < responses.length; i++) {\n            this.addBarGraphRow(target, name, responses[i], i, highestResponseCount);\n        }\n    }\n\n    /**\n     * Sort the responses in the graph by how many had the same response.\n     * @param {string} targetId\n     */\n    static sortBarGraph(targetId) {\n        let target = document.getElementById(targetId);\n        if (target === null) {\n            return;\n        }\n        let isSorting = true;\n        while (isSorting) {\n            isSorting = false;\n            for (let i = 0; i < (target.rows.length - 1); i++) {\n                const current = parseInt(target.rows[i].dataset.percent);\n                const next = parseInt(target.rows[i + 1].dataset.percent);\n                if (current < next) {\n                    target.rows[i].parentNode.insertBefore(target.rows[i + 1], target.rows[i]);\n                    isSorting = true;\n                    break;\n                }\n            }\n        }\n    }\n\n    /**\n     * Create and sort a bar graph based on the responses passed.\n     * @param {string} wrapperId\n     * @param {string} tableId\n     * @param {Array.<Object>} responses\n     * @param {number|undefined} responded How many students responded to the question\n     * @param {string} questionType\n     * @param {string} graphId\n     * @param {boolean} rebuild If the graph should be rebuilt or not.\n     */\n    set(wrapperId, tableId, responses, responded, questionType, graphId, rebuild) {\n        if (responses === undefined) {\n            return;\n        }\n        const quizResponded = document.querySelector(selectors.quiz.responded);\n\n        // Check if any responses to show.\n        if (responses.length === 0) {\n            quizResponded.classList.remove('hidden');\n            setText(quizResponded.querySelector('h4'), 'a_out_of_b_responded', 'jazzquiz', {\n                a: 0,\n                b: this.totalStudents\n            });\n            return;\n        }\n\n        // Question type specific.\n        switch (questionType) {\n            case 'shortanswer':\n                for (let i = 0; i < responses.length; i++) {\n                    responses[i].response = responses[i].response.trim();\n                }\n                break;\n            case 'stack':\n                // Remove all spaces from responses.\n                for (let i = 0; i < responses.length; i++) {\n                    responses[i].response = responses[i].response.replace(/\\s/g, '');\n                }\n                break;\n            default:\n                break;\n        }\n\n        // Update data.\n        this.currentResponses = [];\n        this.respondedCount = 0;\n        for (let i = 0; i < responses.length; i++) {\n            let exists = false;\n            let count = 1;\n            if (responses[i].count !== undefined) {\n                count = parseInt(responses[i].count);\n            }\n            this.respondedCount += count;\n            // Check if response is a duplicate.\n            for (let j = 0; j < this.currentResponses.length; j++) {\n                if (this.currentResponses[j].response === responses[i].response) {\n                    this.currentResponses[j].count += count;\n                    exists = true;\n                    break;\n                }\n            }\n            // Add element if not a duplicate.\n            if (!exists) {\n                this.currentResponses.push({\n                    response: responses[i].response,\n                    count: count,\n                    qtype: questionType\n                });\n            }\n        }\n\n        // Update responded container.\n        if (quizResponded.length !== 0 && responded !== undefined) {\n            quizResponded.classList.remove('hidden');\n            setText(quizResponded.querySelector('h4'), 'a_out_of_b_responded', 'jazzquiz', {\n                a: responded,\n                b: this.totalStudents\n            });\n        }\n\n        // Should we show the responses?\n        if (!this.showResponses && this.quiz.state !== 'reviewing') {\n            document.querySelector(selectors.quiz.responseInfo).classList.add('hidden');\n            document.querySelector(selectors.quiz.responses).classList.add('hidden');\n            return;\n        }\n\n        if (document.getElementById(tableId) === null) {\n            const wrapper = document.getElementById(wrapperId);\n            wrapper.innerHTML = `<table id=\"${tableId}\" class=\"jazzquiz-responses-overview\"></table>`;\n            wrapper.classList.remove('hidden');\n        }\n        this.createBarGraph(this.currentResponses, 'current_response', tableId, graphId, rebuild);\n        ResponseView.sortBarGraph(tableId);\n    }\n\n    /**\n     * Fetch and show results for the ongoing or previous question.\n     * @param {boolean} rebuild If the response graph should be rebuilt or not.\n     */\n    refresh(rebuild) {\n        Ajax.get('get_results', {}, data => {\n            this.quiz.question.hasVotes = data.has_votes;\n            this.totalStudents = parseInt(data.total_students);\n\n            this.set('jazzquiz_responses_container', 'current_responses_wrapper',\n                data.responses, data.responded, data.question_type, 'results', rebuild);\n\n            const undoMergeButton = document.querySelector(selectors.quiz.undoMergeButton);\n            if (undoMergeButton) {\n                undoMergeButton.classList.toggle('hidden', data.merge_count <= 0);\n            }\n        });\n    }\n\n    /**\n     * Method refresh() equivalent for votes.\n     */\n    refreshVotes() {\n        const quizResponses = document.querySelector(selectors.quiz.responses);\n        const quizResponseInfo = document.querySelector(selectors.quiz.responseInfo);\n        // Should we show the results?\n        if (!this.showResponses && this.quiz.state !== 'reviewing') {\n            quizResponseInfo.classList.add('hidden');\n            quizResponses.classList.add('hidden');\n            return;\n        }\n        Ajax.get('get_vote_results', {}, data => {\n            const answers = data.answers;\n            const targetId = 'wrapper_vote_responses';\n            let responses = [];\n            this.respondedCount = 0;\n            this.totalStudents = parseInt(data.total_students);\n            for (let i in answers) {\n                if (!answers.hasOwnProperty(i)) {\n                    continue;\n                }\n                responses.push({\n                    response: answers[i].attempt,\n                    count: answers[i].finalcount,\n                    qtype: answers[i].qtype,\n                    slot: answers[i].slot\n                });\n                this.respondedCount += parseInt(answers[i].finalcount);\n            }\n            setText(document.querySelector(selectors.quiz.responded + ' h4'), 'a_out_of_b_voted', 'jazzquiz', {\n                a: this.respondedCount,\n                b: this.totalStudents\n            });\n            if (document.getElementById(targetId) === null) {\n                quizResponses.innerHTML = `<table id=\"${targetId}\" class=\"jazzquiz-responses-overview\"></table>`;\n                quizResponses.classList.remove('hidden');\n            }\n            this.createBarGraph(responses, 'vote_response', targetId, 'vote', false);\n            ResponseView.sortBarGraph(targetId);\n        });\n    }\n\n}\n\nclass Instructor {\n\n    /**\n     * @param {Quiz} quiz\n     */\n    constructor(quiz) {\n        this.quiz = quiz;\n        this.responses = new ResponseView(quiz);\n        this.isShowingCorrectAnswer = false;\n        this.totalQuestions = 0;\n        this.allowVote = false;\n\n        document.addEventListener('keyup', event => {\n            if (event.key === 'Escape') {\n                Instructor.closeFullscreenView();\n            }\n        });\n\n        Instructor.addEvents({\n            'repoll': () => this.repollQuestion(),\n            'vote': () => this.runVoting(),\n            'improvise': () => this.showQuestionListSetup('improvise'),\n            'jump': () => this.showQuestionListSetup('jump'),\n            'next': () => this.nextQuestion(),\n            'random': () => this.randomQuestion(),\n            'end': () => this.endQuestion(),\n            'fullscreen': () => Instructor.showFullscreenView(),\n            'answer': () => this.showCorrectAnswer(),\n            'responses': () => this.responses.toggle(),\n            'exit': () => this.closeSession(),\n            'quit': () => this.closeSession(),\n            'startquiz': () => this.startQuiz()\n        });\n\n        Instructor.addHotkeys({\n            't': 'responses',\n            'r': 'repoll',\n            'a': 'answer',\n            'e': 'end',\n            'j': 'jump',\n            'i': 'improvise',\n            'v': 'vote',\n            'n': 'next',\n            'm': 'random',\n            'f': 'fullscreen'\n        });\n\n        document.addEventListener('click', event => {\n            Instructor.closeQuestionListMenu(event, 'improvise');\n            Instructor.closeQuestionListMenu(event, 'jump');\n            if (event.target.closest(selectors.quiz.startQuizButton)) {\n                this.startQuiz();\n            }\n            if (event.target.closest(selectors.quiz.exitQuizButton)) {\n                this.closeSession();\n            }\n        });\n    }\n\n    static addHotkeys(keys) {\n        for (let key in keys) {\n            if (keys.hasOwnProperty(key)) {\n                keys[key] = {\n                    action: keys[key],\n                    repeat: false // TODO: Maybe event.repeat becomes more standard?\n                };\n\n                document.addEventListener('keydown', event => {\n                    if (keys[key].repeat || event.ctrlKey) {\n                        return;\n                    }\n                    if (event.key.toLowerCase() !== key) {\n                        return;\n                    }\n                    let focusedTag = $(':focus').prop('tagName');\n                    if (focusedTag !== undefined) {\n                        focusedTag = focusedTag.toLowerCase();\n                        if (focusedTag === 'input' || focusedTag === 'textarea') {\n                            return;\n                        }\n                    }\n                    event.preventDefault();\n                    keys[key].repeat = true;\n                    let $control = Instructor.control(keys[key].action);\n                    if ($control.length && !$control.prop('disabled')) {\n                        $control.click();\n                    }\n                });\n\n                document.addEventListener('keyup', event => {\n                    if (event.key.toLowerCase() === key) {\n                        keys[key].repeat = false;\n                    }\n                });\n            }\n        }\n    }\n\n    static addEvents(events) {\n        document.addEventListener('click', event => {\n            const controlButton = event.target.closest(selectors.quiz.controlButton);\n            if (controlButton) {\n                Instructor.enableControls([]);\n                events[controlButton.dataset.control]();\n            }\n        });\n    }\n\n    static get controls() {\n        return document.querySelector(selectors.quiz.controlsBox);\n    }\n\n    static get controlButtons() {\n        return document.querySelector(selectors.quiz.controlButtons);\n    }\n\n    static control(key) {\n        return document.getElementById(`jazzquiz_control_${key}`);\n    }\n\n    static get side() {\n        return document.querySelector(selectors.quiz.sideContainer);\n    }\n\n    static get correctAnswer() {\n        return document.querySelector(selectors.quiz.correctAnswerContainer);\n    }\n\n    static get isMerging() {\n        return $('.merge-from').length !== 0;\n    }\n\n    onNotRunning(data) {\n        this.responses.totalStudents = data.student_count;\n        Instructor.side.classList.add('hidden');\n        setText(document.querySelector(selectors.quiz.info), 'instructions_for_instructor');\n        Instructor.enableControls([]);\n        document.querySelector(selectors.quiz.controlButtons).classList.add('hidden');\n        const studentsJoined = document.querySelector(selectors.quiz.studentsJoinedCounter);\n        if (data.student_count === 1) {\n            setText(studentsJoined, 'one_student_has_joined');\n        } else if (data.student_count > 1) {\n            setText(studentsJoined, 'x_students_have_joined', 'jazzquiz', data.student_count);\n        } else {\n            setText(studentsJoined, 'no_students_have_joined');\n        }\n        const startQuizButton = Instructor.control('startquiz');\n        startQuizButton.parentElement.classList.remove('hidden');\n    }\n\n    onPreparing(data) {\n        Instructor.side.classList.add('hidden');\n        setText(document.querySelector(selectors.quiz.info), 'instructions_for_instructor');\n        let enabledButtons = ['improvise', 'jump', 'random', 'fullscreen', 'quit'];\n        if (data.slot < this.totalQuestions) {\n            enabledButtons.push('next');\n        }\n        Instructor.enableControls(enabledButtons);\n    }\n\n    onRunning(data) {\n        if (!this.responses.showResponses) {\n            this.responses.hide();\n        }\n        Instructor.side.classList.remove('hidden');\n        Instructor.enableControls(['end', 'responses', 'fullscreen']);\n        this.quiz.question.questionTime = data.questiontime;\n        if (this.quiz.question.isRunning) {\n            // Check if the question has already ended.\n            // We need to do this because the state does not update unless an instructor is connected.\n            if (data.questionTime > 0 && data.delay < -data.questiontime) {\n                this.endQuestion();\n            }\n            // Only rebuild results if we are not merging.\n            this.responses.refresh(!Instructor.isMerging);\n        } else {\n            const started = this.quiz.question.startCountdown(data.questiontime, data.delay);\n            if (started) {\n                this.quiz.question.isRunning = true;\n            }\n        }\n    }\n\n    onReviewing(data) {\n        Instructor.side.classList.remove('hidden');\n        let enabledButtons = ['answer', 'repoll', 'fullscreen', 'improvise', 'jump', 'random', 'quit'];\n        if (this.allowVote) {\n            enabledButtons.push('vote');\n        }\n        if (data.slot < this.totalQuestions) {\n            enabledButtons.push('next');\n        }\n        Instructor.enableControls(enabledButtons);\n\n        // In case page was refreshed, we should ensure the question is showing.\n        if (!Question.isLoaded()) {\n            this.quiz.question.refresh();\n        }\n\n        // For now, just always show responses while reviewing.\n        // In the future, there should be an additional toggle.\n        if (this.quiz.isNewState) {\n            this.responses.show();\n        }\n        // No longer in question.\n        this.quiz.question.isRunning = false;\n    }\n\n    onSessionClosed() {\n        Instructor.side.classList.add('hidden');\n        Instructor.correctAnswer.classList.add('hidden');\n        Instructor.enableControls([]);\n        this.responses.clear();\n        this.quiz.question.isRunning = false;\n    }\n\n    onVoting() {\n        if (!this.responses.showResponses) {\n            this.responses.hide();\n        }\n        Instructor.side.classList.remove('hidden');\n        Instructor.enableControls(['quit', 'fullscreen', 'answer', 'responses', 'end']);\n        this.responses.refreshVotes();\n    }\n\n    onStateChange() {\n        //$('#region-main').find('ul.nav.nav-tabs').css('display', 'none');\n        //$('#region-main-settings-menu').css('display', 'none');\n        //$('.region_main_settings_menu_proxy').css('display', 'none');\n\n        Instructor.controlButtons.classList.remove('hidden');\n        Instructor.control('startquiz').parentElement.classList.add('hidden');\n\n    }\n\n    onQuestionRefreshed(data) {\n        this.allowVote = data.voteable;\n    }\n\n    onTimerEnding() {\n        this.endQuestion();\n    }\n\n    onTimerTick(timeLeft) {\n        setText(document.querySelector(selectors.question.timer), 'x_seconds_left', 'jazzquiz', timeLeft);\n    }\n\n    /**\n     * Start the quiz. Does not start any questions.\n     */\n    startQuiz() {\n        Instructor.control('startquiz').parentElement.classList.add('hidden');\n        Ajax.post('start_quiz', {}, () => {\n            const controls = document.querySelector(selectors.quiz.controls);\n            if (controls) {\n                controls.classList.remove('btn-hide');\n            }\n        });\n    }\n\n    /**\n     * End the currently ongoing question or vote.\n     */\n    endQuestion() {\n        this.quiz.question.hideTimer();\n        Ajax.post('end_question', {}, () => {\n            if (this.quiz.state === 'voting') {\n                this.responses.showVotesUponReview = true;\n            } else {\n                this.quiz.question.isRunning = false;\n                Instructor.enableControls([]);\n            }\n        });\n    }\n\n    /**\n     * Show a question list dropdown.\n     * @param {string} name\n     */\n    showQuestionListSetup(name) {\n        let controlButton = Instructor.control(name);\n        if (controlButton.classList.contains('active')) {\n            // It's already open. Let's not send another request.\n            return;\n        }\n        Ajax.get(`list_${name}_questions`, {}, data => {\n            controlButton.classList.add('active');\n            const menu = document.querySelector(`#jazzquiz_${name}_menu`);\n            menu.innerHTML = '';\n            menu.classList.add('active');\n            const margin = controlButton.getBoundingClientRect().left - controlButton.parentElement.getBoundingClientRect().left;\n            menu.style.marginLeft = margin + 'px';\n            const questions = data.questions;\n            for (let i in questions) {\n                if (!questions.hasOwnProperty(i)) {\n                    continue;\n                }\n                let questionButton = document.createElement('BUTTON');\n                questionButton.classList.add('btn');\n                Quiz.addMathjaxElement(questionButton, questions[i].name);\n                questionButton.dataset.time = questions[i].time;\n                questionButton.dataset.questionId = questions[i].questionid;\n                questionButton.dataset.jazzquizQuestionId = questions[i].jazzquizquestionid;\n                questionButton.addEventListener('click', () => {\n                    const questionId = questionButton.dataset.questionId;\n                    const time = questionButton.dataset.time;\n                    const jazzQuestionId = questionButton.dataset.jazzquizQuestionId;\n                    this.jumpQuestion(questionId, time, jazzQuestionId);\n                    menu.innerHTML = '';\n                    menu.classList.remove('active');\n                    controlButton.classList.remove('active');\n                });\n                menu.appendChild(questionButton);\n            }\n        });\n    }\n\n    /**\n     * Get the selected responses.\n     * @returns {Array.<Object>} Vote options\n     */\n    static getSelectedAnswersForVote() {\n        return document.querySelectorAll(selectors.quiz.selectedVoteOption).map(option => {\n            return {text: option.dataset.response, count: option.dataset.count};\n        });\n    }\n\n    /**\n     * Start a vote with the responses that are currently selected.\n     */\n    runVoting() {\n        const options = Instructor.getSelectedAnswersForVote();\n        const data = {questions: encodeURIComponent(JSON.stringify(options))};\n        Ajax.post('run_voting', data);\n    }\n\n    /**\n     * Start a new question in this session.\n     * @param {string} method\n     * @param {number} questionId\n     * @param {number} questionTime\n     * @param {number} jazzquizQuestionId\n     */\n    startQuestion(method, questionId, questionTime, jazzquizQuestionId) {\n        document.querySelector(selectors.quiz.info).classList.add('hidden');\n        this.responses.clear();\n        this.hideCorrectAnswer();\n        Ajax.post('start_question', {\n            method: method,\n            questionid: questionId,\n            questiontime: questionTime,\n            jazzquizquestionid: jazzquizQuestionId\n        }, data => this.quiz.question.startCountdown(data.questiontime, data.delay));\n    }\n\n    /**\n     * Jump to a planned question in the quiz.\n     * @param {number} questionId\n     * @param {number} questionTime\n     * @param {number} jazzquizQuestionId\n     */\n    jumpQuestion(questionId, questionTime, jazzquizQuestionId) {\n        this.startQuestion('jump', questionId, questionTime, jazzquizQuestionId);\n    }\n\n    /**\n     * Repoll the previously asked question.\n     */\n    repollQuestion() {\n        this.startQuestion('repoll', 0, 0, 0);\n    }\n\n    /**\n     * Continue on to the next preplanned question.\n     */\n    nextQuestion() {\n        this.startQuestion('next', 0, 0, 0);\n    }\n\n    /**\n     * Start a random question.\n     */\n    randomQuestion() {\n        this.startQuestion('random', 0, 0, 0);\n    }\n\n    /**\n     * Close the current session.\n     */\n    closeSession() {\n        document.querySelector(selectors.quiz.undoMergeButton).classList.add('hidden');\n        document.querySelector(selectors.question.box).classList.add('hidden');\n        Instructor.controls.classList.add('hidden');\n        setText(document.querySelector(selectors.quiz.info), 'closing_session');\n        // eslint-disable-next-line no-return-assign\n        Ajax.post('close_session', {}, () => window.location = location.href.split('&')[0]);\n    }\n\n    /**\n     * Hide the correct answer if showing.\n     */\n    hideCorrectAnswer() {\n        if (this.isShowingCorrectAnswer) {\n            Instructor.correctAnswer.classList.add('hidden');\n            Instructor.control('answer').querySelector('.fa').classList.replace('fa-check-square-o', 'fa-square-o');\n            this.isShowingCorrectAnswer = false;\n        }\n    }\n\n    /**\n     * Request and show the correct answer for the ongoing or previous question.\n     */\n    showCorrectAnswer() {\n        this.hideCorrectAnswer();\n        Ajax.get('get_right_response', {}, data => {\n            Instructor.correctAnswer.innerHTML = data.right_answer;\n            Instructor.correctAnswer.classList.remove('hidden');\n            Quiz.renderAllMathjax();\n            Instructor.control('answer').querySelector('.fa').classList.replace('fa-square-o', 'fa-check-square-o');\n            this.isShowingCorrectAnswer = true;\n        });\n    }\n\n    /**\n     * Enables all buttons passed in arguments, but disables all others.\n     * @param {Array.<string>} buttons The unique part of the IDs of the buttons to be enabled.\n     */\n    static enableControls(buttons) {\n        document.querySelectorAll(selectors.quiz.controlButton).forEach(controlButton => {\n            controlButton.disabled = (buttons.indexOf(controlButton.dataset.control) === -1);\n        });\n    }\n\n    /**\n     * Enter fullscreen mode for better use with projectors.\n     */\n    static showFullscreenView() {\n        if (document.querySelector(selectors.main).classList.contains('jazzquiz-fullscreen')) {\n            Instructor.closeFullscreenView();\n            return;\n        }\n        // Hide the scrollbar - remember to always set back to auto when closing.\n        document.documentElement.style.overflowY = 'hidden';\n        // Sets the quiz view to an absolute position that covers the viewport.\n        document.querySelector(selectors.main).classList.add('jazzquiz-fullscreen');\n    }\n\n    /**\n     * Exit the fullscreen mode.\n     */\n    static closeFullscreenView() {\n        document.documentElement.style.overflowY = 'auto';\n        document.querySelector(selectors.main).classList.remove('jazzquiz-fullscreen');\n    }\n\n    /**\n     * Close the dropdown menu for choosing a question.\n     * @param {Event} event\n     * @param {string} name\n     */\n    static closeQuestionListMenu(event, name) {\n        // Close the menu if the click was not inside.\n        if (!event.target.closest(`#jazzquiz_${name}_menu`)) {\n            const menu = document.querySelector(`#jazzquiz_${name}_menu`);\n            menu.innerHTML = '';\n            menu.classList.remove('active');\n            const controlButton = document.querySelector(`#jazzquiz_control_${name}`);\n            if (controlButton) {\n                controlButton.classList.remove('active');\n            }\n        }\n    }\n\n    static addReportEventHandlers() {\n        document.addEventListener('click', event => {\n            const reportOverviewControlsButton = event.target.closest('#report_overview_controls button');\n            if (reportOverviewControlsButton) {\n                const action = reportOverviewControlsButton.dataset.action;\n                if (action === 'attendance') {\n                    document.querySelector(selectors.quiz.reportOverviewResponded).classList.remove('hidden');\n                    document.querySelector(selectors.quiz.reportOverviewResponses).classList.add('hidden');\n                } else if (action === 'responses') {\n                    document.querySelector(selectors.quiz.reportOverviewResponses).classList.remove('hidden');\n                    document.querySelector(selectors.quiz.reportOverviewResponded).classList.add('hidden');\n                }\n            }\n        });\n    }\n\n}\n\nexport const initialize = (totalQuestions, reportView, slots) => {\n    const quiz = new Quiz(Instructor);\n    quiz.role.totalQuestions = totalQuestions;\n    if (reportView) {\n        Instructor.addReportEventHandlers();\n        quiz.role.responses.showResponses = true;\n        slots.forEach(slot => {\n            const wrapper = 'jazzquiz_wrapper_responses_' + slot.num;\n            const table = 'responses_wrapper_table_' + slot.num;\n            const graph = 'report_' + slot.num;\n            quiz.role.responses.set(wrapper, table, slot.responses, undefined, slot.type, graph, false);\n        });\n    } else {\n        quiz.poll(500);\n    }\n};\n"],"names":["ResponseView","constructor","quiz","currentResponses","showVotesUponReview","respondedCount","showResponses","totalStudents","document","addEventListener","event","target","closest","selectors","undoMergeButton","undoMerge","showNormalResultsButton","refresh","showVoteResultsButton","refreshVotes","classList","contains","startMerge","id","parentNode","clear","querySelector","responses","innerHTML","responseInfo","hide","Instructor","control","replace","add","show","remove","this","toggle","endMerge","querySelectorAll","mergeInto","forEach","element","mergeFrom","post","merge","from","into","fromRowBarId","barCell","getElementById","row","parentElement","fromRow","dataset","response","tableRow","cell","createControls","name","quizResponseInfo","question","hasVotes","state","showNormalResult","showVoteResult","html","children","addBarGraphRow","i","highestResponseCount","percent","parseInt","count","rowIndex","currentRowIndex","j","rows","length","insertRow","responseIndex","countHtml","responseCell","insertCell","onclick","latexId","addMathjaxElement","qtype","renderMaximaEquation","currentRow","containsOutside","countElement","barElement","firstElementChild","style","width","createBarGraph","targetId","graphId","rebuild","prune","deleteRow","isSorting","insertBefore","set","wrapperId","tableId","responded","questionType","undefined","quizResponded","a","b","trim","exists","push","wrapper","sortBarGraph","get","data","has_votes","total_students","question_type","merge_count","quizResponses","answers","hasOwnProperty","attempt","finalcount","slot","isShowingCorrectAnswer","totalQuestions","allowVote","key","closeFullscreenView","addEvents","repollQuestion","runVoting","showQuestionListSetup","nextQuestion","randomQuestion","endQuestion","showFullscreenView","showCorrectAnswer","closeSession","startQuiz","addHotkeys","closeQuestionListMenu","startQuizButton","exitQuizButton","keys","action","repeat","ctrlKey","toLowerCase","focusedTag","prop","preventDefault","$control","click","events","controlButton","enableControls","controls","controlsBox","controlButtons","side","sideContainer","correctAnswer","correctAnswerContainer","isMerging","onNotRunning","student_count","info","studentsJoined","studentsJoinedCounter","onPreparing","enabledButtons","onRunning","questionTime","questiontime","isRunning","delay","startCountdown","onReviewing","Question","isLoaded","isNewState","onSessionClosed","onVoting","onStateChange","onQuestionRefreshed","voteable","onTimerEnding","onTimerTick","timeLeft","timer","hideTimer","menu","margin","getBoundingClientRect","left","marginLeft","questions","questionButton","createElement","time","questionId","questionid","jazzquizQuestionId","jazzquizquestionid","jazzQuestionId","jumpQuestion","appendChild","selectedVoteOption","map","option","text","options","getSelectedAnswersForVote","encodeURIComponent","JSON","stringify","startQuestion","method","hideCorrectAnswer","box","window","location","href","split","right_answer","renderAllMathjax","buttons","disabled","indexOf","main","documentElement","overflowY","reportOverviewControlsButton","reportOverviewResponded","reportOverviewResponses","reportView","slots","Quiz","role","addReportEventHandlers","num","table","graph","type","poll"],"mappings":"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"}