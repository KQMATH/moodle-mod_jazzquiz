{"version":3,"file":"instructor.min.js","sources":["../src/instructor.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module    mod_jazzquiz\n * @author    Sebastian S. Gundersen <sebastian@sgundersen.com>\n * @copyright 2014 University of Wisconsin - Madison\n * @copyright 2018 NTNU\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Jazz from 'mod_jazzquiz/core';\nimport selectors from 'mod_jazzquiz/selectors';\n\nconst Quiz = Jazz.Quiz;\nconst Question = Jazz.Question;\nconst Ajax = Jazz.Ajax;\nconst setText = Jazz.setText;\n\nclass ResponseView {\n\n    /**\n     * @param {Quiz} quiz\n     */\n    constructor(quiz) {\n        this.quiz = quiz;\n        this.currentResponses = [];\n        this.showVotesUponReview = false;\n        this.respondedCount = 0;\n        this.showResponses = false;\n        this.totalStudents = 0;\n\n        document.addEventListener('click', event => {\n            const undoMergeButton = event.target.closest(selectors.quiz.undoMergeButton);\n            if (undoMergeButton) {\n                this.undoMerge();\n            }\n\n            const showNormalResultsButton = event.target.closest(selectors.quiz.showNormalResultsButton);\n            if (showNormalResultsButton) {\n                this.refresh(false);\n            }\n\n            const showVoteResultsButton = event.target.closest(selectors.quiz.showVoteResultsButton);\n            if (showVoteResultsButton) {\n                this.refreshVotes();\n            }\n\n            // Clicking a row to merge.\n            if (event.target.classList.contains('bar')) {\n                this.startMerge(event.target.id);\n            } else if (event.target.parentNode && event.target.parentNode.classList.contains('bar')) {\n                this.startMerge(event.target.parentNode.id);\n            }\n        });\n    }\n\n    /**\n     * Clear, but not hide responses.\n     */\n    clear() {\n        Quiz.responses.html('');\n        Quiz.responseInfo.html('');\n    }\n\n    /**\n     * Hides the responses\n     */\n    hide() {\n        Quiz.uncheck(Instructor.control('responses'));\n        Quiz.hide(Quiz.responses);\n        Quiz.hide(Quiz.responseInfo);\n    }\n\n    /**\n     * Shows the responses\n     */\n    show() {\n        Quiz.check(Instructor.control('responses'));\n        Quiz.show(Quiz.responses);\n        Quiz.show(Quiz.responseInfo);\n        if (this.showVotesUponReview) {\n            this.refreshVotes();\n            this.showVotesUponReview = false;\n        } else {\n            this.refresh(false);\n        }\n    }\n\n    /**\n     * Toggle whether to show or hide the responses\n     */\n    toggle() {\n        this.showResponses = !this.showResponses;\n        if (this.showResponses) {\n            this.show();\n        } else {\n            this.hide();\n        }\n    }\n\n    /**\n     * End the response merge.\n     */\n    endMerge() {\n        document.querySelectorAll(selectors.quiz.mergeInto).forEach(element => element.classList.remove('merge-into'));\n        document.querySelectorAll(selectors.quiz.mergeFrom).forEach(element => element.classList.remove('merge-from'));\n    }\n\n    /**\n     * Undo the last response merge.\n     */\n    undoMerge() {\n        Ajax.post('undo_merge', {}, () => this.refresh(true));\n    }\n\n    /**\n     * Merges responses based on response string.\n     * @param {string} from\n     * @param {string} into\n     */\n    merge(from, into) {\n        Ajax.post('merge_responses', {from: from, into: into}, () => this.refresh(false));\n    }\n\n    /**\n     * Start a merge between two responses.\n     * @param {string} fromRowBarId\n     */\n    startMerge(fromRowBarId) {\n        const barCell = document.getElementById(fromRowBarId);\n        const row = barCell.parentElement;\n        if (row.classList.contains('merge-from')) {\n            this.endMerge();\n            return;\n        }\n        if (row.classList.contains('merge-into')) {\n            const fromRow = document.querySelector(selectors.quiz.mergeFrom);\n            this.merge(fromRow.dataset.response, row.dataset.response);\n            this.endMerge();\n            return;\n        }\n        row.classList.add('merge-from');\n        row.closest('table').querySelectorAll('tr').forEach(tableRow => {\n            const cell = tableRow.querySelector('td:nth-child(2)');\n            if (cell && cell.id !== barCell.id) {\n                tableRow.classList.add('merge-into');\n            }\n        });\n    }\n\n    /**\n     * Create controls to toggle between the responses of the actual question and the vote that followed.\n     * @param {string} name Can be either 'vote_response' or 'current_response'\n     */\n    createControls(name) {\n        if (!this.quiz.question.hasVotes) {\n            Quiz.hide(Quiz.responseInfo);\n            return;\n        }\n        // Add button for instructor to change what to review.\n        if (this.quiz.state === 'reviewing') {\n            let $showNormalResult = $('#review_show_normal_results');\n            let $showVoteResult = $('#review_show_vote_results');\n            Quiz.show(Quiz.responseInfo);\n            if (name === 'vote_response') {\n                if ($showNormalResult.length === 0) {\n                    setText(Quiz.responseInfo.html('<h4 class=\"inline\"></h4>').children('h4'), 'showing_vote_results');\n                    Quiz.responseInfo.append('<button id=\"review_show_normal_results\" class=\"btn btn-primary\"></button><br>');\n                    setText($('#review_show_normal_results'), 'click_to_show_original_results');\n                    $showVoteResult.remove();\n                }\n            } else if (name === 'current_response') {\n                if ($showVoteResult.length === 0) {\n                    setText(Quiz.responseInfo.html('<h4 class=\"inline\"></h4>').children('h4'), 'showing_original_results');\n                    Quiz.responseInfo.append('<button id=\"review_show_vote_results\" class=\"btn btn-primary\"></button><br>');\n                    setText($('#review_show_vote_results'), 'click_to_show_vote_results');\n                    $showNormalResult.remove();\n                }\n            }\n        }\n    }\n\n    addBarGraphRow(target, name, response, i, highestResponseCount) {\n        // Const percent = (parseInt(responses[i].count) / total) * 100;\n        const percent = (parseInt(response.count) / highestResponseCount) * 100;\n\n        // Check if row with same response already exists.\n        let rowIndex = -1;\n        let currentRowIndex = -1;\n        for (let j = 0; j < target.rows.length; j++) {\n            if (target.rows[j].dataset.response === response.response) {\n                rowIndex = parseInt(target.rows[j].dataset.rowIndex);\n                currentRowIndex = j;\n                break;\n            }\n        }\n\n        if (rowIndex === -1) {\n            rowIndex = target.rows.length;\n            let row = target.insertRow();\n            row.dataset.responseIndex = i;\n            row.dataset.response = response.response;\n            row.dataset.percent = percent;\n            row.dataset.rowIndex = rowIndex;\n            row.dataset.count = response.count;\n            row.classList.add('selected-vote-option');\n            if (percent < 15) {\n                row.classList.add('outside');\n            }\n\n            const countHtml = '<span id=\"' + name + '_count_' + rowIndex + '\">' + response.count + '</span>';\n            let responseCell = row.insertCell(0);\n            responseCell.onclick = function() {\n                $(this).parent().toggleClass('selected-vote-option');\n            };\n\n            let barCell = row.insertCell(1);\n            barCell.classList.add('bar');\n            barCell.id = name + '_bar_' + rowIndex;\n            barCell.innerHTML = '<div style=\"width:' + percent + '%;\">' + countHtml + '</div>';\n\n            const latexId = name + '_latex_' + rowIndex;\n            responseCell.innerHTML = '<span id=\"' + latexId + '\"></span>';\n            Quiz.addMathjaxElement($('#' + latexId), response.response);\n            if (response.qtype === 'stack') {\n                Quiz.renderMaximaEquation(response.response, latexId);\n            }\n        } else {\n            let currentRow = target.rows[currentRowIndex];\n            currentRow.dataset.rowIndex = rowIndex;\n            currentRow.dataset.responseIndex = i;\n            currentRow.dataset.percent = percent;\n            currentRow.dataset.count = response.count;\n            const containsOutside = currentRow.classList.contains('outside');\n            if (percent > 15 && containsOutside) {\n                currentRow.classList.remove('outside');\n            } else if (percent < 15 && !containsOutside) {\n                currentRow.classList.add('outside');\n            }\n            let countElement = document.getElementById(name + '_count_' + rowIndex);\n            if (countElement !== null) {\n                countElement.innerHTML = response.count;\n            }\n            let barElement = document.getElementById(name + '_bar_' + rowIndex);\n            if (barElement !== null) {\n                barElement.firstElementChild.style.width = percent + '%';\n            }\n        }\n    }\n\n    /**\n     * Create a new and unsorted response bar graph.\n     *\n     * @param {Array.<Object>} responses\n     * @param {string} name\n     * @param {string} targetId\n     * @param {string} graphId\n     * @param {boolean} rebuild If the table should be completely rebuilt or not\n     */\n    createBarGraph(responses, name, targetId, graphId, rebuild) {\n        let target = document.getElementById(targetId);\n        if (target === null) {\n            return;\n        }\n        let highestResponseCount = 0;\n        for (let i = 0; i < responses.length; i++) {\n            let count = parseInt(responses[i].count); // In case count is a string.\n            if (count > highestResponseCount) {\n                highestResponseCount = count;\n            }\n        }\n\n        // Remove the rows if it should be rebuilt.\n        if (rebuild) {\n            target.innerHTML = '';\n        }\n\n        // Prune rows.\n        for (let i = 0; i < target.rows.length; i++) {\n            let prune = true;\n            for (let j = 0; j < responses.length; j++) {\n                if (target.rows[i].dataset.response === responses[j].response) {\n                    prune = false;\n                    break;\n                }\n            }\n            if (prune) {\n                target.deleteRow(i);\n                i--;\n            }\n        }\n\n        // Add rows.\n        this.createControls(name);\n        name += graphId;\n        for (let i = 0; i < responses.length; i++) {\n            this.addBarGraphRow(target, name, responses[i], i, highestResponseCount);\n        }\n    }\n\n    /**\n     * Sort the responses in the graph by how many had the same response.\n     * @param {string} targetId\n     */\n    static sortBarGraph(targetId) {\n        let target = document.getElementById(targetId);\n        if (target === null) {\n            return;\n        }\n        let isSorting = true;\n        while (isSorting) {\n            isSorting = false;\n            for (let i = 0; i < (target.rows.length - 1); i++) {\n                const current = parseInt(target.rows[i].dataset.percent);\n                const next = parseInt(target.rows[i + 1].dataset.percent);\n                if (current < next) {\n                    target.rows[i].parentNode.insertBefore(target.rows[i + 1], target.rows[i]);\n                    isSorting = true;\n                    break;\n                }\n            }\n        }\n    }\n\n    /**\n     * Create and sort a bar graph based on the responses passed.\n     * @param {string} wrapperId\n     * @param {string} tableId\n     * @param {Array.<Object>} responses\n     * @param {number|undefined} responded How many students responded to the question\n     * @param {string} questionType\n     * @param {string} graphId\n     * @param {boolean} rebuild If the graph should be rebuilt or not.\n     */\n    set(wrapperId, tableId, responses, responded, questionType, graphId, rebuild) {\n        if (responses === undefined) {\n            return;\n        }\n\n        // Check if any responses to show.\n        if (responses.length === 0) {\n            Quiz.show(Quiz.responded);\n            setText(Quiz.responded.find('h4'), 'a_out_of_b_responded', 'jazzquiz', {\n                a: 0,\n                b: this.totalStudents\n            });\n            return;\n        }\n\n        // Question type specific.\n        switch (questionType) {\n            case 'shortanswer':\n                for (let i = 0; i < responses.length; i++) {\n                    responses[i].response = responses[i].response.trim();\n                }\n                break;\n            case 'stack':\n                // Remove all spaces from responses.\n                for (let i = 0; i < responses.length; i++) {\n                    responses[i].response = responses[i].response.replace(/\\s/g, '');\n                }\n                break;\n            default:\n                break;\n        }\n\n        // Update data.\n        this.currentResponses = [];\n        this.respondedCount = 0;\n        for (let i = 0; i < responses.length; i++) {\n            let exists = false;\n            let count = 1;\n            if (responses[i].count !== undefined) {\n                count = parseInt(responses[i].count);\n            }\n            this.respondedCount += count;\n            // Check if response is a duplicate.\n            for (let j = 0; j < this.currentResponses.length; j++) {\n                if (this.currentResponses[j].response === responses[i].response) {\n                    this.currentResponses[j].count += count;\n                    exists = true;\n                    break;\n                }\n            }\n            // Add element if not a duplicate.\n            if (!exists) {\n                this.currentResponses.push({\n                    response: responses[i].response,\n                    count: count,\n                    qtype: questionType\n                });\n            }\n        }\n\n        // Update responded container.\n        if (Quiz.responded.length !== 0 && responded !== undefined) {\n            Quiz.show(Quiz.responded);\n            setText(Quiz.responded.find('h4'), 'a_out_of_b_responded', 'jazzquiz', {\n                a: responded,\n                b: this.totalStudents\n            });\n        }\n\n        // Should we show the responses?\n        if (!this.showResponses && this.quiz.state !== 'reviewing') {\n            Quiz.hide(Quiz.responseInfo);\n            Quiz.hide(Quiz.responses);\n            return;\n        }\n\n        if (document.getElementById(tableId) === null) {\n            const html = '<table id=\"' + tableId + '\" class=\"jazzquiz-responses-overview\"></table>';\n            Quiz.show($('#' + wrapperId).html(html));\n        }\n        this.createBarGraph(this.currentResponses, 'current_response', tableId, graphId, rebuild);\n        ResponseView.sortBarGraph(tableId);\n    }\n\n    /**\n     * Fetch and show results for the ongoing or previous question.\n     * @param {boolean} rebuild If the response graph should be rebuilt or not.\n     */\n    refresh(rebuild) {\n        Ajax.get('get_results', {}, data => {\n            this.quiz.question.hasVotes = data.has_votes;\n            this.totalStudents = parseInt(data.total_students);\n\n            this.set('jazzquiz_responses_container', 'current_responses_wrapper',\n                data.responses, data.responded, data.question_type, 'results', rebuild);\n\n            if (data.merge_count > 0) {\n                Quiz.show($('#jazzquiz_undo_merge'));\n            } else {\n                Quiz.hide($('#jazzquiz_undo_merge'));\n            }\n        });\n    }\n\n    /**\n     * Method refresh() equivalent for votes.\n     */\n    refreshVotes() {\n        // Should we show the results?\n        if (!this.showResponses && this.quiz.state !== 'reviewing') {\n            Quiz.hide(Quiz.responseInfo);\n            Quiz.hide(Quiz.responses);\n            return;\n        }\n        Ajax.get('get_vote_results', {}, data => {\n            const answers = data.answers;\n            const targetId = 'wrapper_vote_responses';\n            let responses = [];\n\n            this.respondedCount = 0;\n            this.totalStudents = parseInt(data.total_students);\n\n            for (let i in answers) {\n                if (!answers.hasOwnProperty(i)) {\n                    continue;\n                }\n                responses.push({\n                    response: answers[i].attempt,\n                    count: answers[i].finalcount,\n                    qtype: answers[i].qtype,\n                    slot: answers[i].slot\n                });\n                this.respondedCount += parseInt(answers[i].finalcount);\n            }\n\n            setText(Quiz.responded.find('h4'), 'a_out_of_b_voted', 'jazzquiz', {\n                a: this.respondedCount,\n                b: this.totalStudents\n            });\n\n            if (document.getElementById(targetId) === null) {\n                const html = '<table id=\"' + targetId + '\" class=\"jazzquiz-responses-overview\"></table>';\n                Quiz.show(Quiz.responses.html(html));\n            }\n\n            this.createBarGraph(responses, 'vote_response', targetId, 'vote', false);\n            ResponseView.sortBarGraph(targetId);\n        });\n    }\n\n}\n\nclass Instructor {\n\n    /**\n     * @param {Quiz} quiz\n     */\n    constructor(quiz) {\n        this.quiz = quiz;\n        this.responses = new ResponseView(quiz);\n        this.isShowingCorrectAnswer = false;\n        this.totalQuestions = 0;\n        this.allowVote = false;\n\n        $(document).on('keyup', event => {\n            if (event.keyCode === 27) { // Escape key.\n                Instructor.closeFullscreenView();\n            }\n        });\n\n        $(document).on('click', event => {\n            Instructor.closeQuestionListMenu(event, 'improvise');\n            Instructor.closeQuestionListMenu(event, 'jump');\n        });\n\n        Instructor.addEvents({\n            'repoll': () => this.repollQuestion(),\n            'vote': () => this.runVoting(),\n            'improvise': () => this.showQuestionListSetup('improvise'),\n            'jump': () => this.showQuestionListSetup('jump'),\n            'next': () => this.nextQuestion(),\n            'random': () => this.randomQuestion(),\n            'end': () => this.endQuestion(),\n            'fullscreen': () => Instructor.showFullscreenView(),\n            'answer': () => this.showCorrectAnswer(),\n            'responses': () => this.responses.toggle(),\n            'exit': () => this.closeSession(),\n            'quit': () => this.closeSession(),\n            'startquiz': () => this.startQuiz()\n        });\n\n        Instructor.addHotkeys({\n            't': 'responses',\n            'r': 'repoll',\n            'a': 'answer',\n            'e': 'end',\n            'j': 'jump',\n            'i': 'improvise',\n            'v': 'vote',\n            'n': 'next',\n            'm': 'random',\n            'f': 'fullscreen'\n        });\n    }\n\n    static addHotkeys(keys) {\n        for (let key in keys) {\n            if (keys.hasOwnProperty(key)) {\n                keys[key] = {\n                    action: keys[key],\n                    repeat: false // TODO: Maybe event.repeat becomes more standard?\n                };\n                $(document).on('keydown', event => {\n                    if (keys[key].repeat || event.ctrlKey) {\n                        return;\n                    }\n                    if (String.fromCharCode(event.which).toLowerCase() !== key) {\n                        return;\n                    }\n                    let focusedTag = $(':focus').prop('tagName');\n                    if (focusedTag !== undefined) {\n                        focusedTag = focusedTag.toLowerCase();\n                        if (focusedTag === 'input' || focusedTag === 'textarea') {\n                            return;\n                        }\n                    }\n                    event.preventDefault();\n                    keys[key].repeat = true;\n                    let $control = Instructor.control(keys[key].action);\n                    if ($control.length && !$control.prop('disabled')) {\n                        $control.click();\n                    }\n                });\n                $(document).on('keyup', event => {\n                    if (String.fromCharCode(event.which).toLowerCase() === key) {\n                        keys[key].repeat = false;\n                    }\n                });\n            }\n        }\n    }\n\n    static addEvents(events) {\n        for (let key in events) {\n            if (events.hasOwnProperty(key)) {\n                $(document).on('click', '#jazzquiz_control_' + key, () => {\n                    Instructor.enableControls([]);\n                    events[key]();\n                });\n            }\n        }\n    }\n\n    static get controls() {\n        return $('#jazzquiz_controls_box');\n    }\n\n    static get controlButtons() {\n        return Instructor.controls.find('.quiz-control-buttons');\n    }\n\n    static control(key) {\n        return $('#jazzquiz_control_' + key);\n    }\n\n    static get side() {\n        return $('#jazzquiz_side_container');\n    }\n\n    static get correctAnswer() {\n        return $('#jazzquiz_correct_answer_container');\n    }\n\n    static get isMerging() {\n        return $('.merge-from').length !== 0;\n    }\n\n    onNotRunning(data) {\n        this.responses.totalStudents = data.student_count;\n        Quiz.hide(Instructor.side);\n        setText(Quiz.info, 'instructions_for_instructor');\n        Instructor.enableControls([]);\n        Quiz.hide(Instructor.controlButtons);\n        let $studentsJoined = Instructor.control('startquiz').next();\n        if (data.student_count === 1) {\n            setText($studentsJoined, 'one_student_has_joined');\n        } else if (data.student_count > 1) {\n            setText($studentsJoined, 'x_students_have_joined', 'jazzquiz', data.student_count);\n        } else {\n            setText($studentsJoined, 'no_students_have_joined');\n        }\n        Quiz.show(Instructor.control('startquiz').parent());\n    }\n\n    onPreparing(data) {\n        Quiz.hide(Instructor.side);\n        setText(Quiz.info, 'instructions_for_instructor');\n        let enabledButtons = ['improvise', 'jump', 'random', 'fullscreen', 'quit'];\n        if (data.slot < this.totalQuestions) {\n            enabledButtons.push('next');\n        }\n        Instructor.enableControls(enabledButtons);\n    }\n\n    onRunning(data) {\n        if (!this.responses.showResponses) {\n            this.responses.hide();\n        }\n        Quiz.show(Instructor.side);\n        Instructor.enableControls(['end', 'responses', 'fullscreen']);\n        this.quiz.question.questionTime = data.questiontime;\n        if (this.quiz.question.isRunning) {\n            // Check if the question has already ended.\n            // We need to do this because the state does not update unless an instructor is connected.\n            if (data.questionTime > 0 && data.delay < -data.questiontime) {\n                this.endQuestion();\n            }\n            // Only rebuild results if we are not merging.\n            this.responses.refresh(!Instructor.isMerging);\n        } else {\n            const started = this.quiz.question.startCountdown(data.questiontime, data.delay);\n            if (started) {\n                this.quiz.question.isRunning = true;\n            }\n        }\n    }\n\n    onReviewing(data) {\n        Quiz.show(Instructor.side);\n        let enabledButtons = ['answer', 'repoll', 'fullscreen', 'improvise', 'jump', 'random', 'quit'];\n        if (this.allowVote) {\n            enabledButtons.push('vote');\n        }\n        if (data.slot < this.totalQuestions) {\n            enabledButtons.push('next');\n        }\n        Instructor.enableControls(enabledButtons);\n\n        // In case page was refreshed, we should ensure the question is showing.\n        if (!Question.isLoaded()) {\n            this.quiz.question.refresh();\n        }\n\n        // For now, just always show responses while reviewing.\n        // In the future, there should be an additional toggle.\n        if (this.quiz.isNewState) {\n            this.responses.show();\n        }\n        // No longer in question.\n        this.quiz.question.isRunning = false;\n    }\n\n    onSessionClosed() {\n        Quiz.hide(Instructor.side);\n        Quiz.hide(Instructor.correctAnswer);\n        Instructor.enableControls([]);\n        this.responses.clear();\n        this.quiz.question.isRunning = false;\n    }\n\n    onVoting() {\n        if (!this.responses.showResponses) {\n            this.responses.hide();\n        }\n        Quiz.show(Instructor.side);\n        Instructor.enableControls(['quit', 'fullscreen', 'answer', 'responses', 'end']);\n        this.responses.refreshVotes();\n    }\n\n    onStateChange() {\n        $('#region-main').find('ul.nav.nav-tabs').css('display', 'none');\n        $('#region-main-settings-menu').css('display', 'none');\n        $('.region_main_settings_menu_proxy').css('display', 'none');\n        Quiz.show(Instructor.controlButtons);\n        Quiz.hide(Instructor.control('startquiz').parent());\n    }\n\n    onQuestionRefreshed(data) {\n        this.allowVote = data.voteable;\n    }\n\n    onTimerEnding() {\n        this.endQuestion();\n    }\n\n    onTimerTick(timeLeft) {\n        setText(Question.timer, 'x_seconds_left', 'jazzquiz', timeLeft);\n    }\n\n    /**\n     * Start the quiz. Does not start any questions.\n     */\n    startQuiz() {\n        Quiz.hide(Instructor.control('startquiz').parent());\n        Ajax.post('start_quiz', {}, () => $('#jazzquiz_controls').removeClass('btn-hide'));\n    }\n\n    /**\n     * End the currently ongoing question or vote.\n     */\n    endQuestion() {\n        this.quiz.question.hideTimer();\n        Ajax.post('end_question', {}, () => {\n            if (this.quiz.state === 'voting') {\n                this.responses.showVotesUponReview = true;\n            } else {\n                this.quiz.question.isRunning = false;\n                Instructor.enableControls([]);\n            }\n        });\n    }\n\n    /**\n     * Show a question list dropdown.\n     * @param {string} name\n     */\n    showQuestionListSetup(name) {\n        let $controlButton = Instructor.control(name);\n        if ($controlButton.hasClass('active')) {\n            // It's already open. Let's not send another request.\n            return;\n        }\n        Ajax.get('list_' + name + '_questions', {}, data => {\n            let self = this;\n            let $menu = $('#jazzquiz_' + name + '_menu');\n            const menuMargin = $controlButton.offset().left - $controlButton.parent().offset().left;\n            $menu.html('').addClass('active').css('margin-left', menuMargin + 'px');\n            $controlButton.addClass('active');\n            const questions = data.questions;\n            for (let i in questions) {\n                if (!questions.hasOwnProperty(i)) {\n                    continue;\n                }\n                let $questionButton = $('<button class=\"btn\"></button>');\n                Quiz.addMathjaxElement($questionButton, questions[i].name);\n                $questionButton.data({\n                    'time': questions[i].time,\n                    'question-id': questions[i].questionid,\n                    'jazzquiz-question-id': questions[i].jazzquizquestionid\n                });\n                $questionButton.data('test', 1);\n                $questionButton.on('click', function() {\n                    const questionId = $(this).data('question-id');\n                    const time = $(this).data('time');\n                    const jazzQuestionId = $(this).data('jazzquiz-question-id');\n                    self.jumpQuestion(questionId, time, jazzQuestionId);\n                    $menu.html('').removeClass('active');\n                    $controlButton.removeClass('active');\n                });\n                $menu.append($questionButton);\n            }\n        });\n    }\n\n    /**\n     * Get the selected responses.\n     * @returns {Array.<Object>} Vote options\n     */\n    static getSelectedAnswersForVote() {\n        let result = [];\n        $('.selected-vote-option').each((i, option) => {\n            result.push({\n                text: option.dataset.response,\n                count: option.dataset.count\n            });\n        });\n        return result;\n    }\n\n    /**\n     * Start a vote with the responses that are currently selected.\n     */\n    runVoting() {\n        const options = Instructor.getSelectedAnswersForVote();\n        const data = {questions: encodeURIComponent(JSON.stringify(options))};\n        Ajax.post('run_voting', data);\n    }\n\n    /**\n     * Start a new question in this session.\n     * @param {string} method\n     * @param {number} questionId\n     * @param {number} questionTime\n     * @param {number} jazzquizQuestionId\n     */\n    startQuestion(method, questionId, questionTime, jazzquizQuestionId) {\n        Quiz.hide(Quiz.info);\n        this.responses.clear();\n        this.hideCorrectAnswer();\n        Ajax.post('start_question', {\n            method: method,\n            questionid: questionId,\n            questiontime: questionTime,\n            jazzquizquestionid: jazzquizQuestionId\n        }, data => this.quiz.question.startCountdown(data.questiontime, data.delay));\n    }\n\n    /**\n     * Jump to a planned question in the quiz.\n     * @param {number} questionId\n     * @param {number} questionTime\n     * @param {number} jazzquizQuestionId\n     */\n    jumpQuestion(questionId, questionTime, jazzquizQuestionId) {\n        this.startQuestion('jump', questionId, questionTime, jazzquizQuestionId);\n    }\n\n    /**\n     * Repoll the previously asked question.\n     */\n    repollQuestion() {\n        this.startQuestion('repoll', 0, 0, 0);\n    }\n\n    /**\n     * Continue on to the next preplanned question.\n     */\n    nextQuestion() {\n        this.startQuestion('next', 0, 0, 0);\n    }\n\n    /**\n     * Start a random question.\n     */\n    randomQuestion() {\n        this.startQuestion('random', 0, 0, 0);\n    }\n\n    /**\n     * Close the current session.\n     */\n    closeSession() {\n        Quiz.hide($('#jazzquiz_undo_merge'));\n        Quiz.hide(Question.box);\n        Quiz.hide(Instructor.controls);\n        setText(Quiz.info, 'closing_session');\n        // eslint-disable-next-line no-return-assign\n        Ajax.post('close_session', {}, () => window.location = location.href.split('&')[0]);\n    }\n\n    /**\n     * Hide the correct answer if showing.\n     */\n    hideCorrectAnswer() {\n        if (this.isShowingCorrectAnswer) {\n            Quiz.hide(Instructor.correctAnswer);\n            Quiz.uncheck(Instructor.control('answer'));\n            this.isShowingCorrectAnswer = false;\n        }\n    }\n\n    /**\n     * Request and show the correct answer for the ongoing or previous question.\n     */\n    showCorrectAnswer() {\n        this.hideCorrectAnswer();\n        Ajax.get('get_right_response', {}, data => {\n            Quiz.show(Instructor.correctAnswer.html(data.right_answer));\n            Quiz.renderAllMathjax();\n            Quiz.check(Instructor.control('answer'));\n            this.isShowingCorrectAnswer = true;\n        });\n    }\n\n    /**\n     * Enables all buttons passed in arguments, but disables all others.\n     * @param {Array.<string>} buttons The unique part of the IDs of the buttons to be enabled.\n     */\n    static enableControls(buttons) {\n        Instructor.controlButtons.children('button').each((index, child) => {\n            const id = child.getAttribute('id').replace('jazzquiz_control_', '');\n            child.disabled = (buttons.indexOf(id) === -1);\n        });\n    }\n\n    /**\n     * Enter fullscreen mode for better use with projectors.\n     */\n    static showFullscreenView() {\n        if (Quiz.main.hasClass('jazzquiz-fullscreen')) {\n            Instructor.closeFullscreenView();\n            return;\n        }\n        // Hide the scrollbar - remember to always set back to auto when closing.\n        document.documentElement.style.overflowY = 'hidden';\n        // Sets the quiz view to an absolute position that covers the viewport.\n        Quiz.main.addClass('jazzquiz-fullscreen');\n    }\n\n    /**\n     * Exit the fullscreen mode.\n     */\n    static closeFullscreenView() {\n        document.documentElement.style.overflowY = 'auto';\n        Quiz.main.removeClass('jazzquiz-fullscreen');\n    }\n\n    /**\n     * Close the dropdown menu for choosing a question.\n     * @param {Event} event\n     * @param {string} name\n     */\n    static closeQuestionListMenu(event, name) {\n        const menuId = '#jazzquiz_' + name + '_menu';\n        // Close the menu if the click was not inside.\n        const menu = $(event.target).closest(menuId);\n        if (!menu.length) {\n            $(menuId).html('').removeClass('active');\n            Instructor.control(name).removeClass('active');\n        }\n    }\n\n    static addReportEventHandlers() {\n        $(document).on('click', '#report_overview_controls button', function() {\n            const action = $(this).data('action');\n            if (action === 'attendance') {\n                $('#report_overview_responded').fadeIn();\n                $('#report_overview_responses').fadeOut();\n            } else if (action === 'responses') {\n                $('#report_overview_responses').fadeIn();\n                $('#report_overview_responded').fadeOut();\n            }\n        });\n    }\n\n}\n\nexport const initialize = (totalQuestions, reportView, slots) => {\n    let quiz = new Quiz(Instructor);\n    quiz.role.totalQuestions = totalQuestions;\n    if (reportView) {\n        Instructor.addReportEventHandlers();\n        quiz.role.responses.showResponses = true;\n        slots.forEach(slot => {\n            const wrapper = 'jazzquiz_wrapper_responses_' + slot.num;\n            const table = 'responses_wrapper_table_' + slot.num;\n            const graph = 'report_' + slot.num;\n            quiz.role.responses.set(wrapper, table, slot.responses, undefined, slot.type, graph, false);\n        });\n    } else {\n        quiz.poll(500);\n    }\n};\n"],"names":["Quiz","Jazz","Question","Ajax","setText","ResponseView","constructor","quiz","currentResponses","showVotesUponReview","respondedCount","showResponses","totalStudents","document","addEventListener","event","target","closest","selectors","undoMergeButton","undoMerge","showNormalResultsButton","refresh","showVoteResultsButton","refreshVotes","classList","contains","startMerge","id","parentNode","clear","responses","html","responseInfo","hide","uncheck","Instructor","control","show","check","this","toggle","endMerge","querySelectorAll","mergeInto","forEach","element","remove","mergeFrom","post","merge","from","into","fromRowBarId","barCell","getElementById","row","parentElement","fromRow","querySelector","dataset","response","add","tableRow","cell","createControls","name","question","hasVotes","state","$showNormalResult","$showVoteResult","length","children","append","addBarGraphRow","i","highestResponseCount","percent","parseInt","count","rowIndex","currentRowIndex","j","rows","insertRow","responseIndex","countHtml","responseCell","insertCell","onclick","parent","toggleClass","innerHTML","latexId","addMathjaxElement","qtype","renderMaximaEquation","currentRow","containsOutside","countElement","barElement","firstElementChild","style","width","createBarGraph","targetId","graphId","rebuild","prune","deleteRow","isSorting","insertBefore","set","wrapperId","tableId","responded","questionType","undefined","find","a","b","trim","replace","exists","push","sortBarGraph","get","data","has_votes","total_students","question_type","merge_count","answers","hasOwnProperty","attempt","finalcount","slot","isShowingCorrectAnswer","totalQuestions","allowVote","on","keyCode","closeFullscreenView","closeQuestionListMenu","addEvents","repollQuestion","runVoting","showQuestionListSetup","nextQuestion","randomQuestion","endQuestion","showFullscreenView","showCorrectAnswer","closeSession","startQuiz","addHotkeys","keys","key","action","repeat","ctrlKey","String","fromCharCode","which","toLowerCase","focusedTag","prop","preventDefault","$control","click","events","enableControls","controls","controlButtons","side","correctAnswer","isMerging","onNotRunning","student_count","info","$studentsJoined","next","onPreparing","enabledButtons","onRunning","questionTime","questiontime","isRunning","delay","startCountdown","onReviewing","isLoaded","isNewState","onSessionClosed","onVoting","onStateChange","css","onQuestionRefreshed","voteable","onTimerEnding","onTimerTick","timeLeft","timer","removeClass","hideTimer","$controlButton","hasClass","self","$menu","menuMargin","offset","left","addClass","questions","$questionButton","time","questionid","jazzquizquestionid","questionId","jazzQuestionId","jumpQuestion","result","each","option","text","options","getSelectedAnswersForVote","encodeURIComponent","JSON","stringify","startQuestion","method","jazzquizQuestionId","hideCorrectAnswer","box","window","location","href","split","right_answer","renderAllMathjax","buttons","index","child","getAttribute","disabled","indexOf","main","documentElement","overflowY","menuId","fadeIn","fadeOut","reportView","slots","role","addReportEventHandlers","wrapper","num","table","graph","type","poll"],"mappings":"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"}